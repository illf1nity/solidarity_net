<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOLIDARITY_NET — Workers First</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background-color: #0a0a0a;
      font-family: 'IBM Plex Mono', 'Courier New', monospace;
    }
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #111;
    }
    ::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #444;
    }
    input:focus, textarea:focus, button:focus {
      outline: 1px solid #ff3333;
      outline-offset: 2px;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .notification-enter {
      animation: slideIn 0.3s ease-out;
    }
    .modal-enter {
      animation: fadeIn 0.2s ease-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ============================================
    // API BASE URL
    // ============================================
    const API_BASE = window.location.origin + '/api';

    // ============================================
    // REAL DATA SOURCES & API INTEGRATION
    // ============================================

    // BLS Median Hourly Wage by MSA (Q3 2024 data)
    // Source: Bureau of Labor Statistics Occupational Employment and Wage Statistics
    const MSA_WAGE_DATA = {
      'New York-Newark-Jersey City, NY-NJ-PA': 26.48,
      'Los Angeles-Long Beach-Anaheim, CA': 24.12,
      'Chicago-Naperville-Elgin, IL-IN-WI': 23.67,
      'Dallas-Fort Worth-Arlington, TX': 22.34,
      'Houston-The Woodlands-Sugar Land, TX': 22.89,
      'Washington-Arlington-Alexandria, DC-VA-MD-WV': 28.45,
      'Miami-Fort Lauderdale-Pompano Beach, FL': 20.56,
      'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD': 24.23,
      'Atlanta-Sandy Springs-Alpharetta, GA': 22.15,
      'Boston-Cambridge-Newton, MA-NH': 27.89,
      'Phoenix-Mesa-Chandler, AZ': 21.34,
      'San Francisco-Oakland-Berkeley, CA': 31.45,
      'Riverside-San Bernardino-Ontario, CA': 19.87,
      'Detroit-Warren-Dearborn, MI': 22.45,
      'Seattle-Tacoma-Bellevue, WA': 28.67,
      'Minneapolis-St. Paul-Bloomington, MN-WI': 25.12,
      'San Diego-Chula Vista-Carlsbad, CA': 24.89,
      'Tampa-St. Petersburg-Clearwater, FL': 19.78,
      'Denver-Aurora-Lakewood, CO': 25.56,
      'St. Louis, MO-IL': 21.89,
      'Baltimore-Columbia-Towson, MD': 24.67,
      'Orlando-Kissimmee-Sanford, FL': 18.95,
      'Charlotte-Concord-Gastonia, NC-SC': 22.34,
      'San Antonio-New Braunfels, TX': 20.12,
      'Portland-Vancouver-Hillsboro, OR-WA': 25.23,
      'Sacramento-Roseville-Folsom, CA': 24.45,
      'Pittsburgh, PA': 22.12,
      'Las Vegas-Henderson-Paradise, NV': 20.45,
      'Austin-Round Rock-Georgetown, TX': 24.78,
      'Cincinnati, OH-KY-IN': 21.56,
      'Kansas City, MO-KS': 21.89,
      'Columbus, OH': 22.34,
      'Indianapolis-Carmel-Anderson, IN': 21.23,
      'Cleveland-Elyria, OH': 21.45,
      'San Jose-Sunnyvale-Santa Clara, CA': 35.67,
      'Nashville-Davidson-Murfreesboro-Franklin, TN': 21.78,
      'Virginia Beach-Norfolk-Newport News, VA-NC': 20.89,
      'Providence-Warwick, RI-MA': 23.12,
      'Milwaukee-Waukesha, WI': 22.67,
      'Jacksonville, FL': 20.34,
      'Memphis, TN-MS-AR': 19.45,
      'Oklahoma City, OK': 19.89,
      'Louisville/Jefferson County, KY-IN': 20.56,
      'Hartford-East Hartford-Middletown, CT': 25.34,
      'Richmond, VA': 22.12,
      'New Orleans-Metairie, LA': 19.78,
      'Buffalo-Cheektowaga, NY': 21.23,
      'Raleigh-Cary, NC': 24.45,
      'Birmingham-Hoover, AL': 20.12,
      'Salt Lake City, UT': 22.89,
      'Honolulu, HI': 23.45,
      'Tucson, AZ': 19.56,
      'Fresno, CA': 18.67,
      'Albuquerque, NM': 19.23,
      'Omaha-Council Bluffs, NE-IA': 21.34,
      'Bakersfield, CA': 18.45,
      'default': 22.45  // National median
    };

    // State median hourly wage (2023 BLS OEWS, rounded)
    // Source: Bureau of Labor Statistics Occupational Employment and Wage Statistics (statewide)
    const STATE_WAGE_DATA = {
      'AL': 20.23,
      'AK': 26.41,
      'AZ': 23.08,
      'AR': 19.66,
      'CA': 27.88,
      'CO': 27.12,
      'CT': 27.45,
      'DE': 25.38,
      'FL': 22.12,
      'GA': 22.18,
      'HI': 24.89,
      'ID': 21.58,
      'IL': 25.12,
      'IN': 22.06,
      'IA': 21.97,
      'KS': 21.68,
      'KY': 21.32,
      'LA': 20.34,
      'ME': 22.64,
      'MD': 27.02,
      'MA': 29.32,
      'MI': 23.54,
      'MN': 25.98,
      'MS': 19.32,
      'MO': 22.21,
      'MT': 21.48,
      'NE': 22.11,
      'NV': 22.34,
      'NH': 24.85,
      'NJ': 27.36,
      'NM': 21.12,
      'NY': 27.58,
      'NC': 22.06,
      'ND': 24.12,
      'OH': 22.76,
      'OK': 21.04,
      'OR': 25.34,
      'PA': 24.02,
      'RI': 25.01,
      'SC': 21.24,
      'SD': 21.08,
      'TN': 21.46,
      'TX': 23.16,
      'UT': 24.04,
      'VT': 23.58,
      'VA': 25.68,
      'WA': 29.04,
      'WV': 20.12,
      'WI': 23.48,
      'WY': 23.12,
      'DC': 36.88
    };

    // HUD Fair Market Rents FY2024 (2-bedroom monthly)
    // Source: HUD Office of Policy Development and Research
    const MSA_RENT_DATA = {
      'New York-Newark-Jersey City, NY-NJ-PA': 2387,
      'Los Angeles-Long Beach-Anaheim, CA': 2166,
      'Chicago-Naperville-Elgin, IL-IN-WI': 1398,
      'Dallas-Fort Worth-Arlington, TX': 1534,
      'Houston-The Woodlands-Sugar Land, TX': 1352,
      'Washington-Arlington-Alexandria, DC-VA-MD-WV': 1987,
      'Miami-Fort Lauderdale-Pompano Beach, FL': 1987,
      'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD': 1456,
      'Atlanta-Sandy Springs-Alpharetta, GA': 1612,
      'Boston-Cambridge-Newton, MA-NH': 2534,
      'Phoenix-Mesa-Chandler, AZ': 1534,
      'San Francisco-Oakland-Berkeley, CA': 2876,
      'Riverside-San Bernardino-Ontario, CA': 1723,
      'Detroit-Warren-Dearborn, MI': 1156,
      'Seattle-Tacoma-Bellevue, WA': 2123,
      'Minneapolis-St. Paul-Bloomington, MN-WI': 1445,
      'San Diego-Chula Vista-Carlsbad, CA': 2234,
      'Tampa-St. Petersburg-Clearwater, FL': 1612,
      'Denver-Aurora-Lakewood, CO': 1845,
      'St. Louis, MO-IL': 1089,
      'Baltimore-Columbia-Towson, MD': 1656,
      'Orlando-Kissimmee-Sanford, FL': 1678,
      'Charlotte-Concord-Gastonia, NC-SC': 1423,
      'San Antonio-New Braunfels, TX': 1267,
      'Portland-Vancouver-Hillsboro, OR-WA': 1756,
      'Sacramento-Roseville-Folsom, CA': 1689,
      'Pittsburgh, PA': 1078,
      'Las Vegas-Henderson-Paradise, NV': 1534,
      'Austin-Round Rock-Georgetown, TX': 1612,
      'Cincinnati, OH-KY-IN': 1045,
      'Kansas City, MO-KS': 1156,
      'Columbus, OH': 1189,
      'Indianapolis-Carmel-Anderson, IN': 1078,
      'Cleveland-Elyria, OH': 989,
      'San Jose-Sunnyvale-Santa Clara, CA': 3123,
      'Nashville-Davidson-Murfreesboro-Franklin, TN': 1534,
      'Virginia Beach-Norfolk-Newport News, VA-NC': 1378,
      'Providence-Warwick, RI-MA': 1456,
      'Milwaukee-Waukesha, WI': 1134,
      'Jacksonville, FL': 1434,
      'Memphis, TN-MS-AR': 1067,
      'Oklahoma City, OK': 1023,
      'Louisville/Jefferson County, KY-IN': 1012,
      'Hartford-East Hartford-Middletown, CT': 1456,
      'Richmond, VA': 1334,
      'New Orleans-Metairie, LA': 1189,
      'Buffalo-Cheektowaga, NY': 1045,
      'Raleigh-Cary, NC': 1534,
      'Birmingham-Hoover, AL': 1045,
      'Salt Lake City, UT': 1445,
      'Honolulu, HI': 2345,
      'Tucson, AZ': 1134,
      'Fresno, CA': 1178,
      'Albuquerque, NM': 1089,
      'Omaha-Council Bluffs, NE-IA': 1067,
      'Bakersfield, CA': 1156,
      'default': 1402  // National median
    };

    // Regional Cost Multipliers (relative to national average = 1.0)
    // Sources: BLS Consumer Price Index, USDA Thrifty Food Plan, EIA utilities
    const REGIONAL_COSTS = {
      'New York-Newark-Jersey City, NY-NJ-PA': { food: 1.15, healthcare: 1.12, transport: 0.85, utilities: 1.08 },
      'Los Angeles-Long Beach-Anaheim, CA': { food: 1.08, healthcare: 1.15, transport: 1.25, utilities: 1.05 },
      'Chicago-Naperville-Elgin, IL-IN-WI': { food: 0.98, healthcare: 1.02, transport: 0.90, utilities: 0.95 },
      'Dallas-Fort Worth-Arlington, TX': { food: 0.95, healthcare: 0.98, transport: 1.15, utilities: 1.02 },
      'Houston-The Woodlands-Sugar Land, TX': { food: 0.93, healthcare: 0.95, transport: 1.18, utilities: 1.05 },
      'Washington-Arlington-Alexandria, DC-VA-MD-WV': { food: 1.05, healthcare: 1.08, transport: 0.92, utilities: 1.02 },
      'Miami-Fort Lauderdale-Pompano Beach, FL': { food: 1.02, healthcare: 1.05, transport: 1.12, utilities: 0.98 },
      'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD': { food: 1.02, healthcare: 1.05, transport: 0.88, utilities: 1.08 },
      'Atlanta-Sandy Springs-Alpharetta, GA': { food: 0.95, healthcare: 0.98, transport: 1.15, utilities: 0.95 },
      'Boston-Cambridge-Newton, MA-NH': { food: 1.10, healthcare: 1.12, transport: 0.85, utilities: 1.15 },
      'Phoenix-Mesa-Chandler, AZ': { food: 0.98, healthcare: 1.02, transport: 1.10, utilities: 1.08 },
      'San Francisco-Oakland-Berkeley, CA': { food: 1.18, healthcare: 1.20, transport: 0.92, utilities: 1.12 },
      'Riverside-San Bernardino-Ontario, CA': { food: 1.02, healthcare: 1.05, transport: 1.22, utilities: 1.02 },
      'Detroit-Warren-Dearborn, MI': { food: 0.92, healthcare: 0.95, transport: 1.10, utilities: 1.05 },
      'Seattle-Tacoma-Bellevue, WA': { food: 1.08, healthcare: 1.10, transport: 0.95, utilities: 0.92 },
      'Minneapolis-St. Paul-Bloomington, MN-WI': { food: 0.95, healthcare: 1.02, transport: 1.02, utilities: 1.02 },
      'San Diego-Chula Vista-Carlsbad, CA': { food: 1.10, healthcare: 1.12, transport: 1.15, utilities: 1.05 },
      'Tampa-St. Petersburg-Clearwater, FL': { food: 0.98, healthcare: 1.00, transport: 1.12, utilities: 0.95 },
      'Denver-Aurora-Lakewood, CO': { food: 1.02, healthcare: 1.05, transport: 1.05, utilities: 0.95 },
      'St. Louis, MO-IL': { food: 0.92, healthcare: 0.95, transport: 1.05, utilities: 0.98 },
      'Baltimore-Columbia-Towson, MD': { food: 1.00, healthcare: 1.05, transport: 0.95, utilities: 1.02 },
      'Orlando-Kissimmee-Sanford, FL': { food: 0.98, healthcare: 1.02, transport: 1.15, utilities: 0.95 },
      'Charlotte-Concord-Gastonia, NC-SC': { food: 0.95, healthcare: 0.98, transport: 1.10, utilities: 0.92 },
      'San Antonio-New Braunfels, TX': { food: 0.92, healthcare: 0.95, transport: 1.12, utilities: 1.02 },
      'Portland-Vancouver-Hillsboro, OR-WA': { food: 1.05, healthcare: 1.08, transport: 1.00, utilities: 0.88 },
      'Sacramento-Roseville-Folsom, CA': { food: 1.05, healthcare: 1.08, transport: 1.15, utilities: 1.02 },
      'Pittsburgh, PA': { food: 0.95, healthcare: 0.98, transport: 1.05, utilities: 1.02 },
      'Las Vegas-Henderson-Paradise, NV': { food: 1.00, healthcare: 1.02, transport: 1.08, utilities: 1.05 },
      'Austin-Round Rock-Georgetown, TX': { food: 0.98, healthcare: 1.00, transport: 1.12, utilities: 1.02 },
      'Cincinnati, OH-KY-IN': { food: 0.90, healthcare: 0.95, transport: 1.05, utilities: 0.98 },
      'Kansas City, MO-KS': { food: 0.92, healthcare: 0.95, transport: 1.08, utilities: 0.98 },
      'Columbus, OH': { food: 0.92, healthcare: 0.98, transport: 1.05, utilities: 0.95 },
      'Indianapolis-Carmel-Anderson, IN': { food: 0.90, healthcare: 0.95, transport: 1.08, utilities: 0.95 },
      'Cleveland-Elyria, OH': { food: 0.92, healthcare: 0.98, transport: 1.02, utilities: 1.00 },
      'San Jose-Sunnyvale-Santa Clara, CA': { food: 1.22, healthcare: 1.25, transport: 1.00, utilities: 1.15 },
      'Nashville-Davidson-Murfreesboro-Franklin, TN': { food: 0.95, healthcare: 0.98, transport: 1.12, utilities: 0.92 },
      'Virginia Beach-Norfolk-Newport News, VA-NC': { food: 0.95, healthcare: 0.98, transport: 1.10, utilities: 0.98 },
      'Providence-Warwick, RI-MA': { food: 1.02, healthcare: 1.05, transport: 0.95, utilities: 1.08 },
      'Milwaukee-Waukesha, WI': { food: 0.95, healthcare: 0.98, transport: 1.00, utilities: 0.98 },
      'Jacksonville, FL': { food: 0.95, healthcare: 0.98, transport: 1.15, utilities: 0.95 },
      'Memphis, TN-MS-AR': { food: 0.88, healthcare: 0.92, transport: 1.10, utilities: 0.92 },
      'Oklahoma City, OK': { food: 0.88, healthcare: 0.90, transport: 1.12, utilities: 0.95 },
      'Louisville/Jefferson County, KY-IN': { food: 0.90, healthcare: 0.95, transport: 1.08, utilities: 0.95 },
      'Hartford-East Hartford-Middletown, CT': { food: 1.05, healthcare: 1.08, transport: 0.95, utilities: 1.12 },
      'Richmond, VA': { food: 0.95, healthcare: 0.98, transport: 1.08, utilities: 0.98 },
      'New Orleans-Metairie, LA': { food: 0.95, healthcare: 0.98, transport: 1.10, utilities: 0.95 },
      'Buffalo-Cheektowaga, NY': { food: 0.95, healthcare: 0.98, transport: 1.00, utilities: 1.05 },
      'Raleigh-Cary, NC': { food: 0.95, healthcare: 1.00, transport: 1.12, utilities: 0.92 },
      'Birmingham-Hoover, AL': { food: 0.88, healthcare: 0.92, transport: 1.12, utilities: 0.95 },
      'Salt Lake City, UT': { food: 0.98, healthcare: 1.00, transport: 1.08, utilities: 0.92 },
      'Honolulu, HI': { food: 1.35, healthcare: 1.15, transport: 0.95, utilities: 1.40 },
      'Tucson, AZ': { food: 0.95, healthcare: 0.98, transport: 1.10, utilities: 1.05 },
      'Fresno, CA': { food: 0.98, healthcare: 0.98, transport: 1.18, utilities: 1.02 },
      'Albuquerque, NM': { food: 0.95, healthcare: 0.95, transport: 1.12, utilities: 0.98 },
      'Omaha-Council Bluffs, NE-IA': { food: 0.90, healthcare: 0.95, transport: 1.05, utilities: 0.95 },
      'Bakersfield, CA': { food: 0.98, healthcare: 0.95, transport: 1.20, utilities: 1.05 },
      'Riverside-San Bernardino-Ontario, CA': { food: 1.02, healthcare: 1.05, transport: 1.22, utilities: 1.02 },
      'default': { food: 1.00, healthcare: 1.00, transport: 1.00, utilities: 1.00 }
    };

    // National baseline costs (monthly, 2024)
    const NATIONAL_BASELINES = {
      food: 475,        // USDA Thrifty Food Plan, single adult
      healthcare: 385,  // Average marketplace premium + out-of-pocket
      transport: 285,   // AAA average vehicle ownership cost
      utilities: 175    // EIA average residential utilities
    };

    // ============================================
    // TAX DATA (2024)
    // Sources: IRS 2024 brackets, Tax Foundation state rates, SSA FICA rates
    // ============================================

    // 2024 Federal Income Tax Brackets (Single Filer)
    // Source: IRS Revenue Procedure 2023-34
    const FEDERAL_TAX_BRACKETS = [
      { min: 0,      max: 11600,  rate: 0.10 },
      { min: 11600,  max: 47150,  rate: 0.12 },
      { min: 47150,  max: 100525, rate: 0.22 },
      { min: 100525, max: 191950, rate: 0.24 },
      { min: 191950, max: 243725, rate: 0.32 },
      { min: 243725, max: 609350, rate: 0.35 },
      { min: 609350, max: Infinity, rate: 0.37 }
    ];

    // 2024 Standard Deduction (Single Filer)
    const FEDERAL_STANDARD_DEDUCTION = 14600;

    // FICA Tax Rates (Employee Share, 2024)
    // Source: SSA, IRS Topic 751
    const FICA_SS_RATE = 0.062;        // Social Security: 6.2%
    const FICA_SS_WAGE_CAP = 168600;   // SS wage base limit 2024
    const FICA_MEDICARE_RATE = 0.0145;  // Medicare: 1.45%

    // State Income Tax Rates (2024, effective rate for single filers at median wage)
    // For progressive states: approximate effective rate at ~$45k annual income
    // For flat-tax states: the flat rate
    // Sources: Tax Foundation 2024 State Income Tax Rates and Brackets
    // https://taxfoundation.org/data/all/state/state-income-tax-rates-2024/
    const STATE_TAX_DATA = {
      // --- No income tax states ---
      'AK': { type: 'none', rate: 0 },
      'FL': { type: 'none', rate: 0 },
      'NV': { type: 'none', rate: 0 },
      'NH': { type: 'none', rate: 0 },         // No wage income tax (interest/dividends only)
      'SD': { type: 'none', rate: 0 },
      'TN': { type: 'none', rate: 0 },
      'TX': { type: 'none', rate: 0 },
      'WA': { type: 'none', rate: 0 },
      'WY': { type: 'none', rate: 0 },

      // --- Flat tax states ---
      'AZ': { type: 'flat', rate: 0.025 },     // 2.5%
      'CO': { type: 'flat', rate: 0.044 },     // 4.40%
      'GA': { type: 'flat', rate: 0.0549 },    // 5.49%
      'ID': { type: 'flat', rate: 0.058 },     // 5.8%
      'IL': { type: 'flat', rate: 0.0495 },    // 4.95%
      'IN': { type: 'flat', rate: 0.0305 },    // 3.05% (state only; locals add ~1-2%)
      'KY': { type: 'flat', rate: 0.04 },      // 4.0%
      'MA': { type: 'flat', rate: 0.05 },      // 5.0%
      'MI': { type: 'flat', rate: 0.0425 },    // 4.25%
      'MS': { type: 'flat', rate: 0.047 },     // 4.7%
      'NC': { type: 'flat', rate: 0.0450 },    // 4.50%
      'ND': { type: 'flat', rate: 0.0195 },    // 1.95%
      'PA': { type: 'flat', rate: 0.0307 },    // 3.07%
      'UT': { type: 'flat', rate: 0.0455 },    // 4.55%

      // --- Progressive tax states (brackets for single filers) ---
      'AL': {
        type: 'progressive',
        deduction: 2500,
        brackets: [
          { min: 0, max: 500, rate: 0.02 },
          { min: 500, max: 3000, rate: 0.04 },
          { min: 3000, max: Infinity, rate: 0.05 }
        ]
      },
      'AR': {
        type: 'progressive',
        deduction: 2270,
        brackets: [
          { min: 0, max: 4400, rate: 0.02 },
          { min: 4400, max: 8800, rate: 0.04 },
          { min: 8800, max: Infinity, rate: 0.044 }
        ]
      },
      'CA': {
        type: 'progressive',
        deduction: 5363,
        brackets: [
          { min: 0, max: 10412, rate: 0.01 },
          { min: 10412, max: 24684, rate: 0.02 },
          { min: 24684, max: 38959, rate: 0.04 },
          { min: 38959, max: 54081, rate: 0.06 },
          { min: 54081, max: 68350, rate: 0.08 },
          { min: 68350, max: 349137, rate: 0.093 },
          { min: 349137, max: 418961, rate: 0.103 },
          { min: 418961, max: 698271, rate: 0.113 },
          { min: 698271, max: Infinity, rate: 0.123 }
        ]
      },
      'CT': {
        type: 'progressive',
        deduction: 0,
        brackets: [
          { min: 0, max: 10000, rate: 0.02 },
          { min: 10000, max: 50000, rate: 0.045 },
          { min: 50000, max: 100000, rate: 0.055 },
          { min: 100000, max: 200000, rate: 0.06 },
          { min: 200000, max: 250000, rate: 0.065 },
          { min: 250000, max: 500000, rate: 0.069 },
          { min: 500000, max: Infinity, rate: 0.0699 }
        ]
      },
      'DE': {
        type: 'progressive',
        deduction: 3250,
        brackets: [
          { min: 0, max: 2000, rate: 0 },
          { min: 2000, max: 5000, rate: 0.022 },
          { min: 5000, max: 10000, rate: 0.039 },
          { min: 10000, max: 20000, rate: 0.048 },
          { min: 20000, max: 25000, rate: 0.052 },
          { min: 25000, max: 60000, rate: 0.0555 },
          { min: 60000, max: Infinity, rate: 0.066 }
        ]
      },
      'HI': {
        type: 'progressive',
        deduction: 2200,
        brackets: [
          { min: 0, max: 2400, rate: 0.014 },
          { min: 2400, max: 4800, rate: 0.032 },
          { min: 4800, max: 9600, rate: 0.055 },
          { min: 9600, max: 14400, rate: 0.064 },
          { min: 14400, max: 19200, rate: 0.068 },
          { min: 19200, max: 24000, rate: 0.072 },
          { min: 24000, max: 36000, rate: 0.076 },
          { min: 36000, max: 48000, rate: 0.079 },
          { min: 48000, max: 150000, rate: 0.0825 },
          { min: 150000, max: 175000, rate: 0.09 },
          { min: 175000, max: 200000, rate: 0.10 },
          { min: 200000, max: Infinity, rate: 0.11 }
        ]
      },
      'IA': {
        type: 'progressive',
        deduction: 2210,
        brackets: [
          { min: 0, max: 6210, rate: 0.044 },
          { min: 6210, max: 31050, rate: 0.0482 },
          { min: 31050, max: Infinity, rate: 0.057 }
        ]
      },
      'KS': {
        type: 'progressive',
        deduction: 3500,
        brackets: [
          { min: 0, max: 15000, rate: 0.031 },
          { min: 15000, max: 30000, rate: 0.0525 },
          { min: 30000, max: Infinity, rate: 0.057 }
        ]
      },
      'LA': {
        type: 'progressive',
        deduction: 0,
        brackets: [
          { min: 0, max: 12500, rate: 0.0185 },
          { min: 12500, max: 50000, rate: 0.035 },
          { min: 50000, max: Infinity, rate: 0.0425 }
        ]
      },
      'ME': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 24500, rate: 0.058 },
          { min: 24500, max: 58050, rate: 0.0675 },
          { min: 58050, max: Infinity, rate: 0.0715 }
        ]
      },
      'MD': {
        type: 'progressive',
        deduction: 2400,
        brackets: [
          { min: 0, max: 1000, rate: 0.02 },
          { min: 1000, max: 2000, rate: 0.03 },
          { min: 2000, max: 3000, rate: 0.04 },
          { min: 3000, max: 100000, rate: 0.0475 },
          { min: 100000, max: 125000, rate: 0.05 },
          { min: 125000, max: 150000, rate: 0.0525 },
          { min: 150000, max: 250000, rate: 0.055 },
          { min: 250000, max: Infinity, rate: 0.0575 }
        ]
      },
      'MN': {
        type: 'progressive',
        deduction: 14575,
        brackets: [
          { min: 0, max: 30070, rate: 0.0535 },
          { min: 30070, max: 98760, rate: 0.068 },
          { min: 98760, max: 183340, rate: 0.0785 },
          { min: 183340, max: Infinity, rate: 0.0985 }
        ]
      },
      'MO': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 1207, rate: 0.02 },
          { min: 1207, max: 2414, rate: 0.025 },
          { min: 2414, max: 3621, rate: 0.03 },
          { min: 3621, max: 4828, rate: 0.035 },
          { min: 4828, max: 6035, rate: 0.04 },
          { min: 6035, max: 7242, rate: 0.045 },
          { min: 7242, max: Infinity, rate: 0.048 }
        ]
      },
      'MT': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 20500, rate: 0.047 },
          { min: 20500, max: Infinity, rate: 0.059 }
        ]
      },
      'NE': {
        type: 'progressive',
        deduction: 7900,
        brackets: [
          { min: 0, max: 3700, rate: 0.0246 },
          { min: 3700, max: 22170, rate: 0.0351 },
          { min: 22170, max: 35730, rate: 0.0501 },
          { min: 35730, max: Infinity, rate: 0.0584 }
        ]
      },
      'NJ': {
        type: 'progressive',
        deduction: 0,
        brackets: [
          { min: 0, max: 20000, rate: 0.014 },
          { min: 20000, max: 35000, rate: 0.0175 },
          { min: 35000, max: 40000, rate: 0.035 },
          { min: 40000, max: 75000, rate: 0.05525 },
          { min: 75000, max: 500000, rate: 0.0637 },
          { min: 500000, max: 1000000, rate: 0.0897 },
          { min: 1000000, max: Infinity, rate: 0.1075 }
        ]
      },
      'NM': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 5500, rate: 0.017 },
          { min: 5500, max: 11000, rate: 0.032 },
          { min: 11000, max: 16000, rate: 0.047 },
          { min: 16000, max: 210000, rate: 0.049 },
          { min: 210000, max: Infinity, rate: 0.059 }
        ]
      },
      'NY': {
        type: 'progressive',
        deduction: 8000,
        brackets: [
          { min: 0, max: 8500, rate: 0.04 },
          { min: 8500, max: 11700, rate: 0.045 },
          { min: 11700, max: 13900, rate: 0.0525 },
          { min: 13900, max: 80650, rate: 0.055 },
          { min: 80650, max: 215400, rate: 0.06 },
          { min: 215400, max: 1077550, rate: 0.0685 },
          { min: 1077550, max: Infinity, rate: 0.109 }
        ]
      },
      'OH': {
        type: 'progressive',
        deduction: 0,
        brackets: [
          { min: 0, max: 26050, rate: 0 },
          { min: 26050, max: 100000, rate: 0.0275 },
          { min: 100000, max: Infinity, rate: 0.035 }
        ]
      },
      'OK': {
        type: 'progressive',
        deduction: 6350,
        brackets: [
          { min: 0, max: 1000, rate: 0.0025 },
          { min: 1000, max: 2500, rate: 0.0075 },
          { min: 2500, max: 3750, rate: 0.0175 },
          { min: 3750, max: 4900, rate: 0.0275 },
          { min: 4900, max: 7200, rate: 0.0375 },
          { min: 7200, max: Infinity, rate: 0.0475 }
        ]
      },
      'OR': {
        type: 'progressive',
        deduction: 2745,
        brackets: [
          { min: 0, max: 4050, rate: 0.0475 },
          { min: 4050, max: 10200, rate: 0.0675 },
          { min: 10200, max: 125000, rate: 0.0875 },
          { min: 125000, max: Infinity, rate: 0.099 }
        ]
      },
      'RI': {
        type: 'progressive',
        deduction: 9600,
        brackets: [
          { min: 0, max: 73450, rate: 0.0375 },
          { min: 73450, max: 166950, rate: 0.0475 },
          { min: 166950, max: Infinity, rate: 0.0599 }
        ]
      },
      'SC': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 3460, rate: 0 },
          { min: 3460, max: 17330, rate: 0.03 },
          { min: 17330, max: Infinity, rate: 0.062 }
        ]
      },
      'VT': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 45400, rate: 0.0335 },
          { min: 45400, max: 110050, rate: 0.066 },
          { min: 110050, max: 229550, rate: 0.076 },
          { min: 229550, max: Infinity, rate: 0.0875 }
        ]
      },
      'VA': {
        type: 'progressive',
        deduction: 4500,
        brackets: [
          { min: 0, max: 3000, rate: 0.02 },
          { min: 3000, max: 5000, rate: 0.03 },
          { min: 5000, max: 17000, rate: 0.05 },
          { min: 17000, max: Infinity, rate: 0.0575 }
        ]
      },
      'WV': {
        type: 'progressive',
        deduction: 0,
        brackets: [
          { min: 0, max: 10000, rate: 0.0236 },
          { min: 10000, max: 25000, rate: 0.0315 },
          { min: 25000, max: 40000, rate: 0.0354 },
          { min: 40000, max: 60000, rate: 0.0472 },
          { min: 60000, max: Infinity, rate: 0.0512 }
        ]
      },
      'WI': {
        type: 'progressive',
        deduction: 12760,
        brackets: [
          { min: 0, max: 14320, rate: 0.035 },
          { min: 14320, max: 28640, rate: 0.044 },
          { min: 28640, max: 315310, rate: 0.053 },
          { min: 315310, max: Infinity, rate: 0.0765 }
        ]
      },
      'DC': {
        type: 'progressive',
        deduction: 14600,
        brackets: [
          { min: 0, max: 10000, rate: 0.04 },
          { min: 10000, max: 40000, rate: 0.06 },
          { min: 40000, max: 60000, rate: 0.065 },
          { min: 60000, max: 250000, rate: 0.085 },
          { min: 250000, max: 500000, rate: 0.0925 },
          { min: 500000, max: 1000000, rate: 0.0975 },
          { min: 1000000, max: Infinity, rate: 0.1075 }
        ]
      }
    };

    // Map MSA to primary state for tax purposes
    // For multi-state MSAs, uses the primary state (where the named city is)
    const MSA_TO_STATE = {
      'New York-Newark-Jersey City, NY-NJ-PA': 'NY',
      'Los Angeles-Long Beach-Anaheim, CA': 'CA',
      'Chicago-Naperville-Elgin, IL-IN-WI': 'IL',
      'Dallas-Fort Worth-Arlington, TX': 'TX',
      'Houston-The Woodlands-Sugar Land, TX': 'TX',
      'Washington-Arlington-Alexandria, DC-VA-MD-WV': 'DC',
      'Miami-Fort Lauderdale-Pompano Beach, FL': 'FL',
      'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD': 'PA',
      'Atlanta-Sandy Springs-Alpharetta, GA': 'GA',
      'Boston-Cambridge-Newton, MA-NH': 'MA',
      'Phoenix-Mesa-Chandler, AZ': 'AZ',
      'San Francisco-Oakland-Berkeley, CA': 'CA',
      'Riverside-San Bernardino-Ontario, CA': 'CA',
      'Detroit-Warren-Dearborn, MI': 'MI',
      'Seattle-Tacoma-Bellevue, WA': 'WA',
      'Minneapolis-St. Paul-Bloomington, MN-WI': 'MN',
      'San Diego-Chula Vista-Carlsbad, CA': 'CA',
      'Tampa-St. Petersburg-Clearwater, FL': 'FL',
      'Denver-Aurora-Lakewood, CO': 'CO',
      'St. Louis, MO-IL': 'MO',
      'Baltimore-Columbia-Towson, MD': 'MD',
      'Orlando-Kissimmee-Sanford, FL': 'FL',
      'Charlotte-Concord-Gastonia, NC-SC': 'NC',
      'San Antonio-New Braunfels, TX': 'TX',
      'Portland-Vancouver-Hillsboro, OR-WA': 'OR',
      'Sacramento-Roseville-Folsom, CA': 'CA',
      'Pittsburgh, PA': 'PA',
      'Las Vegas-Henderson-Paradise, NV': 'NV',
      'Austin-Round Rock-Georgetown, TX': 'TX',
      'Cincinnati, OH-KY-IN': 'OH',
      'Kansas City, MO-KS': 'MO',
      'Columbus, OH': 'OH',
      'Indianapolis-Carmel-Anderson, IN': 'IN',
      'Cleveland-Elyria, OH': 'OH',
      'San Jose-Sunnyvale-Santa Clara, CA': 'CA',
      'Nashville-Davidson-Murfreesboro-Franklin, TN': 'TN',
      'Virginia Beach-Norfolk-Newport News, VA-NC': 'VA',
      'Providence-Warwick, RI-MA': 'RI',
      'Milwaukee-Waukesha, WI': 'WI',
      'Jacksonville, FL': 'FL',
      'Memphis, TN-MS-AR': 'TN',
      'Oklahoma City, OK': 'OK',
      'Louisville/Jefferson County, KY-IN': 'KY',
      'Hartford-East Hartford-Middletown, CT': 'CT',
      'Richmond, VA': 'VA',
      'New Orleans-Metairie, LA': 'LA',
      'Buffalo-Cheektowaga, NY': 'NY',
      'Raleigh-Cary, NC': 'NC',
      'Birmingham-Hoover, AL': 'AL',
      'Salt Lake City, UT': 'UT',
      'Honolulu, HI': 'HI',
      'Tucson, AZ': 'AZ',
      'Fresno, CA': 'CA',
      'Albuquerque, NM': 'NM',
      'Omaha-Council Bluffs, NE-IA': 'NE',
      'Bakersfield, CA': 'CA',
      'default': null  // No state tax for unknown MSA (conservative)
    };

    // Calculate progressive tax from brackets
    const calculateProgressiveTax = (taxableIncome, brackets) => {
      let tax = 0;
      for (const bracket of brackets) {
        if (taxableIncome <= bracket.min) break;
        const taxableInBracket = Math.min(taxableIncome, bracket.max) - bracket.min;
        tax += taxableInBracket * bracket.rate;
      }
      return tax;
    };

    // Calculate federal income tax for a given annual gross income (single filer)
    const calculateFederalTax = (annualGross) => {
      const taxableIncome = Math.max(0, annualGross - FEDERAL_STANDARD_DEDUCTION);
      return calculateProgressiveTax(taxableIncome, FEDERAL_TAX_BRACKETS);
    };

    // Calculate state income tax for a given annual gross income
    const calculateStateTax = (annualGross, stateCode) => {
      if (!stateCode) return 0;
      const stateData = STATE_TAX_DATA[stateCode];
      if (!stateData) return 0;

      if (stateData.type === 'none') return 0;

      if (stateData.type === 'flat') {
        // Flat tax states generally tax all income (simplified)
        return annualGross * stateData.rate;
      }

      // Progressive: apply state standard deduction if available
      const deduction = stateData.deduction || 0;
      const taxableIncome = Math.max(0, annualGross - deduction);
      return calculateProgressiveTax(taxableIncome, stateData.brackets);
    };

    // Calculate FICA taxes (employee share)
    const calculateFICA = (annualGross) => {
      const ssTax = Math.min(annualGross, FICA_SS_WAGE_CAP) * FICA_SS_RATE;
      const medicareTax = annualGross * FICA_MEDICARE_RATE;
      return ssTax + medicareTax;
    };

    // Calculate total effective tax rate and net hourly wage
    const calculateTaxData = (hourlyWage, msa, stateOverride = null) => {
      const annualGross = hourlyWage * 2080; // 40 hrs/wk × 52 weeks
      const stateCode = stateOverride || MSA_TO_STATE[msa] || MSA_TO_STATE.default;

      const federalTax = calculateFederalTax(annualGross);
      const stateTax = calculateStateTax(annualGross, stateCode);
      const ficaTax = calculateFICA(annualGross);
      const totalTax = federalTax + stateTax + ficaTax;

      const effectiveRate = annualGross > 0 ? totalTax / annualGross : 0;
      const netAnnual = annualGross - totalTax;
      const netHourlyWage = netAnnual / 2080;

      return {
        annualGross,
        federalTax,
        stateTax,
        ficaTax,
        totalTax,
        effectiveRate,
        netAnnual,
        netHourlyWage,
        stateCode: stateCode || 'N/A'
      };
    };

    // ZIP code prefix to MSA mapping (first 3 digits)
    const ZIP_TO_MSA = {
      // New York area
      '100': 'New York-Newark-Jersey City, NY-NJ-PA',
      '101': 'New York-Newark-Jersey City, NY-NJ-PA',
      '102': 'New York-Newark-Jersey City, NY-NJ-PA',
      '103': 'New York-Newark-Jersey City, NY-NJ-PA',
      '104': 'New York-Newark-Jersey City, NY-NJ-PA',
      '105': 'New York-Newark-Jersey City, NY-NJ-PA',
      '106': 'New York-Newark-Jersey City, NY-NJ-PA',
      '107': 'New York-Newark-Jersey City, NY-NJ-PA',
      '108': 'New York-Newark-Jersey City, NY-NJ-PA',
      '109': 'New York-Newark-Jersey City, NY-NJ-PA',
      '110': 'New York-Newark-Jersey City, NY-NJ-PA',
      '111': 'New York-Newark-Jersey City, NY-NJ-PA',
      '112': 'New York-Newark-Jersey City, NY-NJ-PA',
      '113': 'New York-Newark-Jersey City, NY-NJ-PA',
      '114': 'New York-Newark-Jersey City, NY-NJ-PA',
      '070': 'New York-Newark-Jersey City, NY-NJ-PA',
      '071': 'New York-Newark-Jersey City, NY-NJ-PA',
      '072': 'New York-Newark-Jersey City, NY-NJ-PA',
      '073': 'New York-Newark-Jersey City, NY-NJ-PA',
      '074': 'New York-Newark-Jersey City, NY-NJ-PA',
      '075': 'New York-Newark-Jersey City, NY-NJ-PA',
      '076': 'New York-Newark-Jersey City, NY-NJ-PA',
      '077': 'New York-Newark-Jersey City, NY-NJ-PA',
      '078': 'New York-Newark-Jersey City, NY-NJ-PA',
      '079': 'New York-Newark-Jersey City, NY-NJ-PA',

      // Los Angeles area
      '900': 'Los Angeles-Long Beach-Anaheim, CA',
      '901': 'Los Angeles-Long Beach-Anaheim, CA',
      '902': 'Beverly Hills, CA',
      '903': 'Los Angeles-Long Beach-Anaheim, CA',
      '904': 'Los Angeles-Long Beach-Anaheim, CA',
      '905': 'Los Angeles-Long Beach-Anaheim, CA',
      '906': 'Los Angeles-Long Beach-Anaheim, CA',
      '907': 'Los Angeles-Long Beach-Anaheim, CA',
      '908': 'Los Angeles-Long Beach-Anaheim, CA',
      '910': 'Los Angeles-Long Beach-Anaheim, CA',
      '911': 'Los Angeles-Long Beach-Anaheim, CA',
      '912': 'Los Angeles-Long Beach-Anaheim, CA',
      '913': 'Los Angeles-Long Beach-Anaheim, CA',
      '914': 'Los Angeles-Long Beach-Anaheim, CA',
      '915': 'Los Angeles-Long Beach-Anaheim, CA',
      '916': 'Los Angeles-Long Beach-Anaheim, CA',
      '917': 'Los Angeles-Long Beach-Anaheim, CA',
      '918': 'Los Angeles-Long Beach-Anaheim, CA',
      '926': 'Los Angeles-Long Beach-Anaheim, CA',
      '927': 'Los Angeles-Long Beach-Anaheim, CA',
      '928': 'Los Angeles-Long Beach-Anaheim, CA',

      // Chicago area
      '606': 'Chicago-Naperville-Elgin, IL-IN-WI',
      '600': 'Chicago-Naperville-Elgin, IL-IN-WI',
      '601': 'Chicago-Naperville-Elgin, IL-IN-WI',
      '602': 'Chicago-Naperville-Elgin, IL-IN-WI',
      '603': 'Chicago-Naperville-Elgin, IL-IN-WI',
      '604': 'Chicago-Naperville-Elgin, IL-IN-WI',
      '605': 'Chicago-Naperville-Elgin, IL-IN-WI',

      // Dallas area
      '750': 'Dallas-Fort Worth-Arlington, TX',
      '751': 'Dallas-Fort Worth-Arlington, TX',
      '752': 'Dallas-Fort Worth-Arlington, TX',
      '753': 'Dallas-Fort Worth-Arlington, TX',
      '754': 'Dallas-Fort Worth-Arlington, TX',
      '760': 'Dallas-Fort Worth-Arlington, TX',
      '761': 'Dallas-Fort Worth-Arlington, TX',
      '762': 'Dallas-Fort Worth-Arlington, TX',

      // Houston area
      '770': 'Houston-The Woodlands-Sugar Land, TX',
      '771': 'Houston-The Woodlands-Sugar Land, TX',
      '772': 'Houston-The Woodlands-Sugar Land, TX',
      '773': 'Houston-The Woodlands-Sugar Land, TX',
      '774': 'Houston-The Woodlands-Sugar Land, TX',
      '775': 'Houston-The Woodlands-Sugar Land, TX',

      // DC area
      '200': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '201': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '202': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '203': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '204': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '205': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '220': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '221': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',
      '222': 'Washington-Arlington-Alexandria, DC-VA-MD-WV',

      // Miami area
      '330': 'Miami-Fort Lauderdale-Pompano Beach, FL',
      '331': 'Miami-Fort Lauderdale-Pompano Beach, FL',
      '332': 'Miami-Fort Lauderdale-Pompano Beach, FL',
      '333': 'Miami-Fort Lauderdale-Pompano Beach, FL',
      '334': 'Miami-Fort Lauderdale-Pompano Beach, FL',

      // Philadelphia area
      '190': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',
      '191': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',
      '192': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',
      '193': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',
      '194': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',
      '080': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',
      '081': 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD',

      // Atlanta area
      '300': 'Atlanta-Sandy Springs-Alpharetta, GA',
      '301': 'Atlanta-Sandy Springs-Alpharetta, GA',
      '302': 'Atlanta-Sandy Springs-Alpharetta, GA',
      '303': 'Atlanta-Sandy Springs-Alpharetta, GA',
      '304': 'Atlanta-Sandy Springs-Alpharetta, GA',
      '305': 'Atlanta-Sandy Springs-Alpharetta, GA',
      '306': 'Atlanta-Sandy Springs-Alpharetta, GA',

      // Boston area
      '021': 'Boston-Cambridge-Newton, MA-NH',
      '020': 'Boston-Cambridge-Newton, MA-NH',
      '022': 'Boston-Cambridge-Newton, MA-NH',
      '023': 'Boston-Cambridge-Newton, MA-NH',
      '024': 'Boston-Cambridge-Newton, MA-NH',
      '017': 'Boston-Cambridge-Newton, MA-NH',
      '018': 'Boston-Cambridge-Newton, MA-NH',
      '019': 'Boston-Cambridge-Newton, MA-NH',

      // Phoenix area
      '850': 'Phoenix-Mesa-Chandler, AZ',
      '851': 'Phoenix-Mesa-Chandler, AZ',
      '852': 'Phoenix-Mesa-Chandler, AZ',
      '853': 'Phoenix-Mesa-Chandler, AZ',

      // San Francisco area
      '941': 'San Francisco-Oakland-Berkeley, CA',
      '940': 'San Francisco-Oakland-Berkeley, CA',
      '942': 'San Francisco-Oakland-Berkeley, CA',
      '943': 'San Francisco-Oakland-Berkeley, CA',
      '944': 'San Francisco-Oakland-Berkeley, CA',
      '945': 'San Francisco-Oakland-Berkeley, CA',
      '946': 'San Francisco-Oakland-Berkeley, CA',
      '947': 'San Francisco-Oakland-Berkeley, CA',

      // Detroit area
      '480': 'Detroit-Warren-Dearborn, MI',
      '481': 'Detroit-Warren-Dearborn, MI',
      '482': 'Detroit-Warren-Dearborn, MI',
      '483': 'Detroit-Warren-Dearborn, MI',

      // Seattle area
      '980': 'Seattle-Tacoma-Bellevue, WA',
      '981': 'Seattle-Tacoma-Bellevue, WA',
      '982': 'Seattle-Tacoma-Bellevue, WA',
      '983': 'Seattle-Tacoma-Bellevue, WA',
      '984': 'Seattle-Tacoma-Bellevue, WA',

      // San Antonio area
      '782': 'San Antonio-New Braunfels, TX',
      '780': 'San Antonio-New Braunfels, TX',
      '781': 'San Antonio-New Braunfels, TX',

      // Denver area
      '800': 'Denver-Aurora-Lakewood, CO',
      '801': 'Denver-Aurora-Lakewood, CO',
      '802': 'Denver-Aurora-Lakewood, CO',
      '803': 'Denver-Aurora-Lakewood, CO',
      '804': 'Denver-Aurora-Lakewood, CO',

      // San Diego area
      '919': 'San Diego-Chula Vista-Carlsbad, CA',
      '920': 'San Diego-Chula Vista-Carlsbad, CA',
      '921': 'San Diego-Chula Vista-Carlsbad, CA',

      // Minneapolis area
      '553': 'Minneapolis-St. Paul-Bloomington, MN-WI',
      '554': 'Minneapolis-St. Paul-Bloomington, MN-WI',
      '555': 'Minneapolis-St. Paul-Bloomington, MN-WI',

      // Tampa area
      '336': 'Tampa-St. Petersburg-Clearwater, FL',
      '335': 'Tampa-St. Petersburg-Clearwater, FL',
      '337': 'Tampa-St. Petersburg-Clearwater, FL',

      // Austin area
      '786': 'Austin-Round Rock-Georgetown, TX',
      '787': 'Austin-Round Rock-Georgetown, TX',

      // Portland area
      '970': 'Portland-Vancouver-Hillsboro, OR-WA',
      '971': 'Portland-Vancouver-Hillsboro, OR-WA',
      '972': 'Portland-Vancouver-Hillsboro, OR-WA',

      // San Jose area
      '950': 'San Jose-Sunnyvale-Santa Clara, CA',
      '951': 'San Jose-Sunnyvale-Santa Clara, CA',

      // Salt Lake City
      '841': 'Salt Lake City, UT',
      '840': 'Salt Lake City, UT',

      // Las Vegas
      '891': 'Las Vegas-Henderson-Paradise, NV',
      '890': 'Las Vegas-Henderson-Paradise, NV',

      // Honolulu
      '967': 'Honolulu, HI',
      '968': 'Honolulu, HI',

      // Orlando
      '328': 'Orlando-Kissimmee-Sanford, FL',
      '327': 'Orlando-Kissimmee-Sanford, FL',
      '347': 'Orlando-Kissimmee-Sanford, FL',

      // Raleigh-Durham
      '276': 'Raleigh-Cary, NC',
      '277': 'Raleigh-Cary, NC',

      // Nashville
      '370': 'Nashville-Davidson-Murfreesboro-Franklin, TN',
      '371': 'Nashville-Davidson-Murfreesboro-Franklin, TN',
      '372': 'Nashville-Davidson-Murfreesboro-Franklin, TN',

      // Charlotte
      '280': 'Charlotte-Concord-Gastonia, NC-SC',
      '281': 'Charlotte-Concord-Gastonia, NC-SC',
      '282': 'Charlotte-Concord-Gastonia, NC-SC',

      // Indianapolis
      '460': 'Indianapolis-Carmel-Anderson, IN',
      '461': 'Indianapolis-Carmel-Anderson, IN',
      '462': 'Indianapolis-Carmel-Anderson, IN',

      // Columbus OH
      '430': 'Columbus, OH',
      '431': 'Columbus, OH',
      '432': 'Columbus, OH',
      '433': 'Columbus, OH',

      // Cleveland
      '440': 'Cleveland-Elyria, OH',
      '441': 'Cleveland-Elyria, OH',
      '442': 'Cleveland-Elyria, OH',

      // Cincinnati
      '450': 'Cincinnati, OH-KY-IN',
      '451': 'Cincinnati, OH-KY-IN',
      '452': 'Cincinnati, OH-KY-IN',

      // Pittsburgh
      '150': 'Pittsburgh, PA',
      '151': 'Pittsburgh, PA',
      '152': 'Pittsburgh, PA',

      // Kansas City
      '640': 'Kansas City, MO-KS',
      '641': 'Kansas City, MO-KS',
      '660': 'Kansas City, MO-KS',
      '661': 'Kansas City, MO-KS',

      // St. Louis
      '630': 'St. Louis, MO-IL',
      '631': 'St. Louis, MO-IL',
      '633': 'St. Louis, MO-IL',

      // Baltimore
      '210': 'Baltimore-Columbia-Towson, MD',
      '211': 'Baltimore-Columbia-Towson, MD',
      '212': 'Baltimore-Columbia-Towson, MD',

      // Milwaukee
      '530': 'Milwaukee-Waukesha, WI',
      '531': 'Milwaukee-Waukesha, WI',
      '532': 'Milwaukee-Waukesha, WI',

      // Sacramento
      '956': 'Sacramento-Roseville-Folsom, CA',
      '957': 'Sacramento-Roseville-Folsom, CA',
      '958': 'Sacramento-Roseville-Folsom, CA',

      // Riverside
      '925': 'Riverside-San Bernardino-Ontario, CA',
      '923': 'Riverside-San Bernardino-Ontario, CA',
      '924': 'Riverside-San Bernardino-Ontario, CA',

      // Jacksonville
      '322': 'Jacksonville, FL',
      '320': 'Jacksonville, FL',

      // Oklahoma City
      '730': 'Oklahoma City, OK',
      '731': 'Oklahoma City, OK',
      '731': 'Oklahoma City, OK',

      // Memphis
      '380': 'Memphis, TN-MS-AR',
      '381': 'Memphis, TN-MS-AR',
      '382': 'Memphis, TN-MS-AR',

      // Louisville
      '400': 'Louisville/Jefferson County, KY-IN',
      '401': 'Louisville/Jefferson County, KY-IN',
      '402': 'Louisville/Jefferson County, KY-IN',

      // Richmond
      '230': 'Richmond, VA',
      '231': 'Richmond, VA',
      '232': 'Richmond, VA',

      // New Orleans
      '700': 'New Orleans-Metairie, LA',
      '701': 'New Orleans-Metairie, LA',

      // Hartford
      '060': 'Hartford-East Hartford-Middletown, CT',
      '061': 'Hartford-East Hartford-Middletown, CT',

      // Providence
      '028': 'Providence-Warwick, RI-MA',
      '029': 'Providence-Warwick, RI-MA',

      // Birmingham
      '350': 'Birmingham-Hoover, AL',
      '351': 'Birmingham-Hoover, AL',
      '352': 'Birmingham-Hoover, AL',

      // Buffalo
      '140': 'Buffalo-Cheektowaga, NY',
      '141': 'Buffalo-Cheektowaga, NY',
      '142': 'Buffalo-Cheektowaga, NY',

      // Tucson
      '856': 'Tucson, AZ',
      '857': 'Tucson, AZ',

      // Fresno
      '936': 'Fresno, CA',
      '937': 'Fresno, CA',

      // Albuquerque
      '871': 'Albuquerque, NM',
      '870': 'Albuquerque, NM',

      // Omaha
      '680': 'Omaha-Council Bluffs, NE-IA',
      '681': 'Omaha-Council Bluffs, NE-IA',

      // Bakersfield
      '932': 'Bakersfield, CA',
      '933': 'Bakersfield, CA',

      // Virginia Beach
      '233': 'Virginia Beach-Norfolk-Newport News, VA-NC',
      '234': 'Virginia Beach-Norfolk-Newport News, VA-NC',
      '235': 'Virginia Beach-Norfolk-Newport News, VA-NC',
      '236': 'Virginia Beach-Norfolk-Newport News, VA-NC',
    };

    const findNearestMSAWage = (zipCode) => {
      const prefix = Number.parseInt(zipCode.substring(0, 3), 10);
      if (Number.isNaN(prefix)) return null;

      let closest = null;
      for (const [prefixKey, msa] of Object.entries(ZIP_TO_MSA)) {
        const wage = MSA_WAGE_DATA[msa];
        if (!wage) continue;
        const candidatePrefix = Number.parseInt(prefixKey, 10);
        if (Number.isNaN(candidatePrefix)) continue;
        const distance = Math.abs(prefix - candidatePrefix);
        if (!closest || distance < closest.distance) {
          closest = {
            wage,
            msa,
            prefix: prefixKey,
            distance
          };
        }
      }

      return closest;
    };

    // Fetch location data from ZIP code API
    const fetchZipData = async (zipCode) => {
      try {
        const response = await fetch(`https://api.zippopotam.us/us/${zipCode}`);
        if (!response.ok) throw new Error('Invalid ZIP code');
        const data = await response.json();
        return {
          city: data.places[0]['place name'],
          state: data.places[0]['state abbreviation'],
          stateFull: data.places[0]['state'],
          latitude: parseFloat(data.places[0].latitude),
          longitude: parseFloat(data.places[0].longitude)
        };
      } catch (error) {
        return null;
      }
    };

    // Get MSA from ZIP code
    const getMSAFromZip = (zipCode) => {
      const prefix = zipCode.substring(0, 3);
      return ZIP_TO_MSA[prefix] || 'default';
    };

    // Calculate local cost data based on ZIP
    const calculateLocalData = (zipCode, locationInfo) => {
      const msa = getMSAFromZip(zipCode);
      const stateCode = locationInfo?.state;
      const msaWage = MSA_WAGE_DATA[msa] || null;
      const nearestMSA = msaWage ? null : findNearestMSAWage(zipCode);
      const stateWage = stateCode ? STATE_WAGE_DATA[stateCode] : null;
      const resolvedWage = msaWage || nearestMSA?.wage || stateWage || MSA_WAGE_DATA.default;
      const wageSource = msaWage
        ? 'MSA-level data'
        : nearestMSA
          ? `Nearest MSA (${nearestMSA.msa}) via ZIP prefix ${nearestMSA.prefix}`
          : stateWage
            ? `State-level data (${stateCode})`
            : 'National averages';
      const rent = MSA_RENT_DATA[msa] || MSA_RENT_DATA.default;
      const costs = REGIONAL_COSTS[msa] || REGIONAL_COSTS.default;

      const areaName = locationInfo
        ? `${locationInfo.city}, ${locationInfo.state}`
        : (msa !== 'default' ? msa.split(',')[0] : 'National Average');

      // Calculate tax data for this area
      const taxData = calculateTaxData(resolvedWage, nearestMSA?.msa || msa, stateWage ? stateCode : null);

      return {
        medianWage: resolvedWage,
        netWage: taxData.netHourlyWage,
        taxData: taxData,
        rent: rent,
        food: Math.round(NATIONAL_BASELINES.food * costs.food),
        healthcare: Math.round(NATIONAL_BASELINES.healthcare * costs.healthcare),
        transport: Math.round(NATIONAL_BASELINES.transport * costs.transport),
        utilities: Math.round(NATIONAL_BASELINES.utilities * costs.utilities),
        area: areaName,
        msa: msa !== 'default' ? msa : null,
        dataQuality: wageSource
      };
    };

    const MOCK_BUILDINGS = {
      '10001': [
        { id: 'b1', address: '123 Main St, Apt 1-24', units: 24, members: 8, landlord: 'Greystone Properties', issues: ['Heat', 'Repairs'] },
        { id: 'b2', address: '456 Oak Ave, Units A-L', units: 12, members: 3, landlord: 'Metro Housing LLC', issues: ['Fees'] },
        { id: 'b3', address: '789 Park Blvd', units: 48, members: 15, landlord: 'Urban Living Corp', issues: ['Security', 'Pests'] },
      ],
      '60601': [
        { id: 'b4', address: '100 Lake Shore Dr', units: 200, members: 42, landlord: 'Lakeside Management', issues: ['Rent increases'] },
        { id: 'b5', address: '250 State St', units: 36, members: 11, landlord: 'Downtown Rentals Inc', issues: ['Maintenance'] },
      ],
      '90210': [
        { id: 'b6', address: '9000 Wilshire Blvd', units: 80, members: 22, landlord: 'Luxury Living LA', issues: ['Parking', 'Amenities'] },
      ],
      'default': [
        { id: 'b7', address: '500 Example St', units: 20, members: 5, landlord: 'Sample Properties', issues: ['General'] },
      ]
    };

    const MOCK_WORKER_COLLECTIVES = [
      { id: 'w1', industry: 'Retail', company: 'MegaMart', members: 127, issues: ['Scheduling', 'Understaffing'], active: true, messages: [] },
      { id: 'w2', industry: 'Food Service', company: 'QuickBite Chain', members: 89, issues: ['Wage theft', 'No breaks'], active: true, messages: [] },
      { id: 'w3', industry: 'Warehouse', company: 'FastShip Logistics', members: 234, issues: ['Safety', 'Quotas'], active: true, messages: [] },
      { id: 'w4', industry: 'Healthcare', company: 'CareFirst Hospital', members: 156, issues: ['Understaffing', 'Mandatory OT'], active: true, messages: [] },
      { id: 'w5', industry: 'Tech', company: 'Anonymous Startup', members: 45, issues: ['Layoffs', 'RTO mandate'], active: false, messages: [] },
      { id: 'w6', industry: 'Education', company: 'City School District', members: 312, issues: ['Class sizes', 'Resources'], active: true, messages: [] },
    ];

    const MOCK_CONSUMER_GROUPS = [
      { id: 'c1', name: 'Internet Access Collective', members: 342, target: 'ISP bulk negotiation', savings: '$15/mo avg', description: 'Negotiating group rates with local ISPs' },
      { id: 'c2', name: 'Grocery Bulk Buy', members: 89, target: 'Wholesale access', savings: '$80/mo avg', description: 'Weekly bulk orders from wholesalers' },
      { id: 'c3', name: 'Utility Bill Co-op', members: 156, target: 'Solar installation', savings: '$45/mo avg', description: 'Community solar purchasing program' },
      { id: 'c4', name: 'Prescription Pool', members: 203, target: 'Medication costs', savings: '$120/mo avg', description: 'Group purchasing for common medications' },
    ];

    const MOCK_PETITIONS = [
      { id: 'p1', title: 'Stop Rent Increase at 123 Main St', area: '10001', signatures: 18, goal: 24, status: 'active', created: '2 days ago', description: 'Landlord proposing 15% increase despite no improvements.' },
      { id: 'p2', title: 'Demand Fair Scheduling at MegaMart', area: '60601', signatures: 89, goal: 100, status: 'active', created: '1 week ago', description: 'End on-call scheduling and provide 2-week advance notice.' },
      { id: 'p3', title: 'Fix Dangerous Intersection on Oak Ave', area: '10001', signatures: 156, goal: 150, status: 'won', created: '3 weeks ago', description: 'Traffic light installed after petition delivered to city council.' },
      { id: 'p4', title: 'Oppose Utility Rate Hike', area: '30301', signatures: 423, goal: 500, status: 'active', created: '4 days ago', description: 'Power company requesting 22% rate increase.' },
      { id: 'p5', title: 'Keep Community Health Clinic Open', area: '48127', signatures: 267, goal: 300, status: 'active', created: '5 days ago', description: 'Only clinic serving uninsured residents in the area.' },
    ];

    const MOCK_REPORTS = [
      { id: 'r1', type: 'landlord', name: 'Greystone Properties', address: '123 Main St', issues: ['No repairs', 'Harassment'], reports: 12, lastReport: '2h ago', details: [] },
      { id: 'r2', type: 'employer', name: 'QuickBite Chain', address: null, issues: ['Wage theft', 'No breaks'], reports: 34, lastReport: '5h ago', details: [] },
      { id: 'r3', type: 'landlord', name: 'Metro Housing LLC', address: '456 Oak Ave', issues: ['Safety hazard', 'Illegal fees'], reports: 7, lastReport: '1d ago', details: [] },
      { id: 'r4', type: 'employer', name: 'FastShip Logistics', address: null, issues: ['Unsafe conditions', 'Retaliation'], reports: 56, lastReport: '3h ago', details: [] },
      { id: 'r5', type: 'landlord', name: 'Urban Living Corp', address: '789 Park Blvd', issues: ['Pest infestation', 'No heat'], reports: 23, lastReport: '8h ago', details: [] },
    ];

    const MOCK_PRICE_RESISTANCE = [
      { id: 'pr1', item: 'Gallon of Gas', current: 3.45, resistance: 4.50, votes: 1247, atResistance: 72 },
      { id: 'pr2', item: 'Dozen Eggs', current: 4.20, resistance: 5.00, votes: 892, atResistance: 85 },
      { id: 'pr3', item: 'Gallon of Milk', current: 3.80, resistance: 5.00, votes: 756, atResistance: 68 },
      { id: 'pr4', item: 'Loaf of Bread', current: 3.50, resistance: 4.50, votes: 634, atResistance: 55 },
      { id: 'pr5', item: 'Internet (Basic)', current: 65, resistance: 80, votes: 1089, atResistance: 45 },
      { id: 'pr6', item: 'Electricity (avg/mo)', current: 150, resistance: 200, votes: 923, atResistance: 38 },
      { id: 'pr7', item: 'Ground Beef (1 lb)', current: 5.50, resistance: 7.00, votes: 445, atResistance: 62 },
      { id: 'pr8', item: 'Streaming Service', current: 15.99, resistance: 20.00, votes: 1567, atResistance: 78 },
    ];

    // ============================================
    // MAIN COMPONENT
    // ============================================

    const SolidarityPlatform = () => {
      // Navigation
      const [activeTab, setActiveTab] = useState('information');
      const [activeSubTab, setActiveSubTab] = useState('sentiment');
      const [notification, setNotification] = useState(null);

      // Information State
      const [zipCode, setZipCode] = useState('');
      const [localData, setLocalData] = useState(null);
      const [loading, setLoading] = useState(false);
      const [zipError, setZipError] = useState(null);
      const [priceVotes, setPriceVotes] = useState({});
      const [priceResistanceItems, setPriceResistanceItems] = useState([]);

      // Formation State
      const [workSentiment, setWorkSentiment] = useState(null);
      const [sentimentHistory, setSentimentHistory] = useState([]);
      const [todaySentiment, setTodaySentiment] = useState({ willing: 0, unwilling: 0, total: 0 });

      // Tenant State
      const [buildings, setBuildings] = useState([]);
      const [selectedBuilding, setSelectedBuilding] = useState(null);
      const [joinedBuildings, setJoinedBuildings] = useState([]);
      const [tenantMessages, setTenantMessages] = useState([]);
      const [newTenantMessage, setNewTenantMessage] = useState('');

      // Worker State
      const [workerCollectives, setWorkerCollectives] = useState([]);
      const [joinedCollectives, setJoinedCollectives] = useState([]);
      const [selectedCollective, setSelectedCollective] = useState(null);
      const [collectiveMessages, setCollectiveMessages] = useState([]);
      const [newCollectiveMessage, setNewCollectiveMessage] = useState('');

      // Consumer State
      const [consumerGroups, setConsumerGroups] = useState([]);
      const [joinedConsumerGroups, setJoinedConsumerGroups] = useState([]);

      // Petition State
      const [petitions, setPetitions] = useState([]);
      const [signedPetitions, setSignedPetitions] = useState([]);
      const [showPetitionForm, setShowPetitionForm] = useState(false);
      const [newPetition, setNewPetition] = useState({ title: '', area: '', description: '', changeorg_url: '' });

      // Report State
      const [reports, setReports] = useState([]);
      const [reportType, setReportType] = useState('landlord');
      const [reportFilter, setReportFilter] = useState('all');
      const [newReport, setNewReport] = useState({ name: '', address: '', issues: [], description: '', anonymous: true });

      // Theft Calculator State
      const [theftAge, setTheftAge] = useState('');
      const [theftIncome, setTheftIncome] = useState('');
      const [theftResults, setTheftResults] = useState(null);
      const [theftLoading, setTheftLoading] = useState(false);
      const [theftError, setTheftError] = useState(null);

      // New Collective Form
      const [showNewCollectiveForm, setShowNewCollectiveForm] = useState(false);
      const [newCollective, setNewCollective] = useState({ company: '', industry: '', issues: [], telegram_url: '' });

      // ============================================
      // TEXT CUSTOMIZATION PANEL
      // ============================================

      // Default text configuration - all customizable text elements
      const defaultTextConfig = {
        // Header
        header_title: 'SOLIDARITY',
        header_title_suffix: 'NET',
        header_tagline: 'Formation • Information • Accountability',
        header_no_tracking: 'NO TRACKING • NO PROFILES',
        header_workers_first: 'WORKERS FIRST',

        // Navigation tabs
        nav_information: 'information',
        nav_formation: 'formation',
        nav_accountability: 'accountability',

        // Formation sub-tabs
        subtab_sentiment: '📊 Work Sentiment',
        subtab_tenant: '🏢 Tenant Unions',
        subtab_worker: '⚡ Worker Collectives',
        subtab_consumer: '🛒 Consumer Groups',
        subtab_petitions: '📋 Petitions',

        // Standard of Living Calculator
        sol_section_title: 'Standard of Living Calculator',
        sol_zip_label: 'ZIP CODE:',
        sol_zip_placeholder: 'Enter ZIP',
        sol_calculate_btn: 'Calculate',
        sol_loading_btn: 'Loading...',
        sol_helper_text: 'Enter any US ZIP code — data sourced from BLS, HUD, USDA, AAA, and EIA',
        sol_weeks_label: 'weeks of work to afford one month of living',
        sol_deficit_label: 'DEFICIT: You need',
        sol_deficit_suffix: 'more hours than a full-time job provides',
        sol_surplus_prefix: 'Technically sustainable with',
        sol_surplus_suffix: 'hours of margin',
        sol_gross_wage: 'Gross hourly wage',
        sol_federal_tax: 'Federal income tax',
        sol_state_tax: 'State tax',
        sol_fica: 'FICA (SS + Medicare)',
        sol_after_tax: 'After-tax hourly wage',
        sol_effective_rate: 'Effective tax rate:',
        sol_hours_label: 'Hours needed per month (at after-tax wage):',
        sol_rent: 'Rent',
        sol_food: 'Food',
        sol_healthcare: 'Healthcare',
        sol_transport: 'Transport',
        sol_utilities: 'Utilities',
        sol_total_required: 'TOTAL REQUIRED',
        sol_available: 'Available (40hr/wk × 4)',
        sol_monthly_result: 'MONTHLY DEFICIT / SURPLUS',
        sol_data_quality: 'Data quality:',

        // Theft Calculator
        theft_section_title: 'What Has Been Stolen From You',
        theft_description: 'Enter your age and income to see how systemic economic policy has personally cost you.',
        theft_age_label: 'AGE:',
        theft_income_label: 'ANNUAL INCOME ($):',
        theft_age_placeholder: '30',
        theft_income_placeholder: '45000',
        theft_calculate_btn: 'Calculate',
        theft_cost_label: 'Cost to You',
        theft_hours_label: 'Hours of Work',
        theft_stolen_by: 'Stolen by:',
        theft_housing: 'Housing policy',
        theft_wages: 'Wage suppression',
        theft_healthcare: 'Healthcare costs',
        theft_education: 'Education debt',

        // Consumer Price Resistance
        price_section_title: 'Consumer Price Resistance',
        price_vote_prompt: 'Is this the right price?',
        price_too_high: 'Too High',
        price_seems_right: 'Seems Right',
        price_too_low: 'Too Low',

        // Work Sentiment
        sentiment_section_title: 'Work Sentiment — Your Area',
        sentiment_question: 'Do you feel like working today?',
        sentiment_yes: 'YES',
        sentiment_no: 'NO',
        sentiment_recorded: 'Response recorded anonymously (fingerprint-based, no account)',
        sentiment_unwilling: "Don't want to work today",
        sentiment_responses: 'Responses in your area',
        sentiment_trend: '4-Week Trend (% unwilling to work)',
        sentiment_trend_msg: 'Worker unwillingness rising 14 points over 4 weeks',

        // Tenant Union Builder
        tenant_section_title: 'Tenant Union Builder',
        tenant_description: 'Find and connect with other tenants in your building. No personal data required.',
        tenant_search_placeholder: 'Enter ZIP to find buildings',
        tenant_search_btn: 'Search Buildings',
        tenant_landlord: 'Landlord:',
        tenant_joined: 'Joined',
        tenant_members: 'Members',
        tenant_organization: 'Organization %',
        tenant_join_btn: 'Join Building',
        tenant_message_btn: 'Message Building',

        // Worker Collectives
        worker_section_title: 'Worker Collectives',
        worker_form_title: 'Start a Worker Collective',
        worker_company_label: 'COMPANY NAME',
        worker_industry_label: 'INDUSTRY TYPE',
        worker_issues_label: 'ISSUE TYPE (select all that apply)',
        worker_create_btn: 'Create Collective',
        worker_join_btn: 'Join Collective',
        worker_message_btn: 'Message',

        // Issue types
        issue_wage_theft: 'Wage theft',
        issue_unsafe: 'Unsafe conditions',
        issue_retaliation: 'Retaliation',
        issue_discrimination: 'Discrimination',
        issue_harassment: 'Harassment',
        issue_scheduling: 'Scheduling abuse',
        issue_unpaid_ot: 'Unpaid overtime',
        issue_other: 'Other',
        issue_no_repairs: 'No repairs',
        issue_illegal_fees: 'Illegal fees',
        issue_safety_hazard: 'Safety hazard',
        issue_pest: 'Pest infestation',
        issue_no_heat: 'No heat/AC',

        // Consumer Groups
        consumer_section_title: 'Consumer Collectives',
        consumer_join_btn: 'Join Group',

        // Petitions
        petition_section_title: 'Local Petitions',
        petition_form_title: 'Link Change.org Petition',
        petition_url_label: 'PETITION URL',
        petition_title_label: 'PETITION TITLE',
        petition_area_label: 'AREA / LOCATION',
        petition_desc_label: 'DESCRIPTION (OPTIONAL)',
        petition_url_placeholder: 'https://www.change.org/p/your-petition',
        petition_title_placeholder: 'What are you petitioning for?',
        petition_area_placeholder: 'Where does this apply?',
        petition_desc_placeholder: 'Explain the issue...',
        petition_create_btn: 'Create Petition',
        petition_refresh_btn: 'Refresh Count',

        // Accountability
        report_section_title: 'Submit Report',
        report_type_landlord: '🏠 Landlord',
        report_type_employer: '💼 Employer',
        report_name_landlord: 'Landlord Name or Management Company',
        report_name_employer: 'Company Name',
        report_address_label: 'Property Address (optional)',
        report_issues_label: 'Issue Type (select all that apply)',
        report_desc_label: 'Description (optional)',
        report_anonymous: 'Post anonymously',
        report_name_landlord_placeholder: 'e.g., Greystone Properties',
        report_name_employer_placeholder: 'e.g., MegaCorp Inc',
        report_address_placeholder: 'e.g., 123 Main St',
        report_desc_placeholder: 'What happened? Be specific but protect your identity.',
        report_submit_btn: 'Submit Report',
        report_footer: 'Reports are public. No moderation by corporations or landlords.',

        // Recent Reports
        reports_section_title: 'Recent Reports',
        reports_filter_all: 'All Reports',
        reports_filter_landlord: 'Landlords',
        reports_filter_employer: 'Employers',
        reports_count_label: 'REPORTS',
        reports_last: 'Last:',

        // Footer
        footer_brand: 'SOLIDARITY_NET',
        footer_tagline: 'Open source. No tracking. No profiles. No ads.',
        footer_source: 'Source Code',
        footer_data: 'Data Sources',
        footer_privacy: 'Privacy',
      };

      // Default font configuration
      const defaultFontConfig = {
        primary: "'IBM Plex Mono', 'Courier New', monospace",
        heading: "'IBM Plex Mono', 'Courier New', monospace",
        body: "'IBM Plex Mono', 'Courier New', monospace",
      };

      // Default color overrides (uses colors object as base)
      const defaultColorConfig = {
        primary: '#ff3333',
        text: '#e8e8e8',
        textMuted: '#888',
        textDim: '#666',
        success: '#33ff33',
        warning: '#ffaa00',
        bg: '#0a0a0a',
        bgLight: '#111',
        border: '#222',
      };

      // Available font options
      const fontOptions = [
        "'IBM Plex Mono', 'Courier New', monospace",
        "'Arial', 'Helvetica', sans-serif",
        "'Georgia', 'Times New Roman', serif",
        "'Times New Roman', 'Times', serif",
        "'Verdana', 'Geneva', sans-serif",
        "'Trebuchet MS', 'Lucida Sans', sans-serif",
        "'Courier New', 'Courier', monospace",
        "'Roboto', 'Arial', sans-serif",
        "'Open Sans', 'Arial', sans-serif",
      ];

      // State for customization
      const [showCustomizationPanel, setShowCustomizationPanel] = useState(false);
      const [textConfig, setTextConfig] = useState(() => {
        const saved = localStorage.getItem('solidaritynet_textConfig');
        return saved ? JSON.parse(saved) : defaultTextConfig;
      });
      const [fontConfig, setFontConfig] = useState(() => {
        const saved = localStorage.getItem('solidaritynet_fontConfig');
        return saved ? JSON.parse(saved) : defaultFontConfig;
      });
      const [colorConfig, setColorConfig] = useState(() => {
        const saved = localStorage.getItem('solidaritynet_colorConfig');
        return saved ? JSON.parse(saved) : defaultColorConfig;
      });
      const [panelTab, setPanelTab] = useState('text');
      const [textFilter, setTextFilter] = useState('');

      // Moderation Panel State
      const [showModerationPanel, setShowModerationPanel] = useState(false);
      const [moderationKey, setModerationKey] = useState(() => localStorage.getItem('solidaritynet_adminKey') || '');
      const [isModeratorAuthenticated, setIsModeratorAuthenticated] = useState(false);
      const [moderationContent, setModerationContent] = useState(null);
      const [moderationTab, setModerationTab] = useState('messages');
      const [moderationLoading, setModerationLoading] = useState(false);
      const [deleteReason, setDeleteReason] = useState('');
      const [banAuthor, setBanAuthor] = useState({ name: '', reason: '' });

      // Save to localStorage when configs change
      useEffect(() => {
        localStorage.setItem('solidaritynet_textConfig', JSON.stringify(textConfig));
      }, [textConfig]);

      useEffect(() => {
        localStorage.setItem('solidaritynet_fontConfig', JSON.stringify(fontConfig));
      }, [fontConfig]);

      useEffect(() => {
        localStorage.setItem('solidaritynet_colorConfig', JSON.stringify(colorConfig));
      }, [colorConfig]);

      // Helper to update text config
      const updateText = (key, value) => {
        setTextConfig(prev => ({ ...prev, [key]: value }));
      };

      // Helper to update font config
      const updateFont = (key, value) => {
        setFontConfig(prev => ({ ...prev, [key]: value }));
      };

      // Helper to update color config
      const updateColor = (key, value) => {
        setColorConfig(prev => ({ ...prev, [key]: value }));
      };

      // Reset to defaults
      const resetTextConfig = () => {
        setTextConfig(defaultTextConfig);
        localStorage.removeItem('solidaritynet_textConfig');
      };

      const resetFontConfig = () => {
        setFontConfig(defaultFontConfig);
        localStorage.removeItem('solidaritynet_fontConfig');
      };

      const resetColorConfig = () => {
        setColorConfig(defaultColorConfig);
        localStorage.removeItem('solidaritynet_colorConfig');
      };

      const resetAllConfig = () => {
        resetTextConfig();
        resetFontConfig();
        resetColorConfig();
      };

      // Export config as JSON
      const exportConfig = () => {
        const config = {
          textConfig,
          fontConfig,
          colorConfig,
          exportedAt: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'solidaritynet_customization.json';
        a.click();
        URL.revokeObjectURL(url);
      };

      // Import config from JSON
      const importConfig = (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const config = JSON.parse(e.target.result);
              if (config.textConfig) setTextConfig({ ...defaultTextConfig, ...config.textConfig });
              if (config.fontConfig) setFontConfig({ ...defaultFontConfig, ...config.fontConfig });
              if (config.colorConfig) setColorConfig({ ...defaultColorConfig, ...config.colorConfig });
              showNotification('Configuration imported successfully', 'success');
            } catch (err) {
              showNotification('Invalid configuration file', 'error');
            }
          };
          reader.readAsText(file);
        }
      };

      // Group text config by category for display
      const textCategories = {
        'Header': ['header_title', 'header_title_suffix', 'header_tagline', 'header_no_tracking', 'header_workers_first'],
        'Navigation': ['nav_information', 'nav_formation', 'nav_accountability', 'subtab_sentiment', 'subtab_tenant', 'subtab_worker', 'subtab_consumer', 'subtab_petitions'],
        'Standard of Living': ['sol_section_title', 'sol_zip_label', 'sol_zip_placeholder', 'sol_calculate_btn', 'sol_loading_btn', 'sol_helper_text', 'sol_weeks_label', 'sol_deficit_label', 'sol_deficit_suffix', 'sol_surplus_prefix', 'sol_surplus_suffix', 'sol_gross_wage', 'sol_federal_tax', 'sol_state_tax', 'sol_fica', 'sol_after_tax', 'sol_effective_rate', 'sol_hours_label', 'sol_rent', 'sol_food', 'sol_healthcare', 'sol_transport', 'sol_utilities', 'sol_total_required', 'sol_available', 'sol_monthly_result', 'sol_data_quality'],
        'Theft Calculator': ['theft_section_title', 'theft_description', 'theft_age_label', 'theft_income_label', 'theft_age_placeholder', 'theft_income_placeholder', 'theft_calculate_btn', 'theft_cost_label', 'theft_hours_label', 'theft_stolen_by', 'theft_housing', 'theft_wages', 'theft_healthcare', 'theft_education'],
        'Price Resistance': ['price_section_title', 'price_vote_prompt', 'price_too_high', 'price_seems_right', 'price_too_low'],
        'Work Sentiment': ['sentiment_section_title', 'sentiment_question', 'sentiment_yes', 'sentiment_no', 'sentiment_recorded', 'sentiment_unwilling', 'sentiment_responses', 'sentiment_trend', 'sentiment_trend_msg'],
        'Tenant Unions': ['tenant_section_title', 'tenant_description', 'tenant_search_placeholder', 'tenant_search_btn', 'tenant_landlord', 'tenant_joined', 'tenant_members', 'tenant_organization', 'tenant_join_btn', 'tenant_message_btn'],
        'Worker Collectives': ['worker_section_title', 'worker_form_title', 'worker_company_label', 'worker_industry_label', 'worker_issues_label', 'worker_create_btn', 'worker_join_btn', 'worker_message_btn'],
        'Issue Labels': ['issue_wage_theft', 'issue_unsafe', 'issue_retaliation', 'issue_discrimination', 'issue_harassment', 'issue_scheduling', 'issue_unpaid_ot', 'issue_other', 'issue_no_repairs', 'issue_illegal_fees', 'issue_safety_hazard', 'issue_pest', 'issue_no_heat'],
        'Consumer Groups': ['consumer_section_title', 'consumer_join_btn'],
        'Petitions': ['petition_section_title', 'petition_form_title', 'petition_url_label', 'petition_title_label', 'petition_area_label', 'petition_desc_label', 'petition_url_placeholder', 'petition_title_placeholder', 'petition_area_placeholder', 'petition_desc_placeholder', 'petition_create_btn', 'petition_refresh_btn'],
        'Submit Report': ['report_section_title', 'report_type_landlord', 'report_type_employer', 'report_name_landlord', 'report_name_employer', 'report_address_label', 'report_issues_label', 'report_desc_label', 'report_anonymous', 'report_name_landlord_placeholder', 'report_name_employer_placeholder', 'report_address_placeholder', 'report_desc_placeholder', 'report_submit_btn', 'report_footer'],
        'Recent Reports': ['reports_section_title', 'reports_filter_all', 'reports_filter_landlord', 'reports_filter_employer', 'reports_count_label', 'reports_last'],
        'Footer': ['footer_brand', 'footer_tagline', 'footer_source', 'footer_data', 'footer_privacy'],
      };

      // ============================================
      // DATA FETCHING
      // ============================================

      // Fetch initial data on mount
      useEffect(() => {
        // Fetch price resistance items
        fetch(`${API_BASE}/price-resistance`)
          .then(r => r.json())
          .then(data => setPriceResistanceItems(data))
          .catch(() => {});

        // Fetch sentiment data
        fetch(`${API_BASE}/sentiment`)
          .then(r => r.json())
          .then(data => {
            setSentimentHistory(data.history);
            setTodaySentiment(data.today);
          })
          .catch(() => {});

        // Fetch worker collectives
        fetch(`${API_BASE}/worker-collectives`)
          .then(r => r.json())
          .then(data => setWorkerCollectives(data))
          .catch(() => {});

        // Fetch consumer groups
        fetch(`${API_BASE}/consumer-groups`)
          .then(r => r.json())
          .then(data => setConsumerGroups(data))
          .catch(() => {});

        // Fetch petitions
        fetch(`${API_BASE}/petitions`)
          .then(r => r.json())
          .then(data => setPetitions(data))
          .catch(() => {});

        // Fetch reports
        fetch(`${API_BASE}/reports`)
          .then(r => r.json())
          .then(data => setReports(data))
          .catch(() => {});
      }, []);

      // Fetch buildings when ZIP changes
      const fetchBuildings = useCallback((zip) => {
        const code = zip || 'default';
        fetch(`${API_BASE}/buildings/${code}`)
          .then(r => r.json())
          .then(data => setBuildings(data))
          .catch(() => {});
      }, []);

      // Fetch messages when a building is selected
      useEffect(() => {
        if (selectedBuilding) {
          fetch(`${API_BASE}/buildings/${selectedBuilding}/messages`)
            .then(r => r.json())
            .then(data => setTenantMessages(data))
            .catch(() => {});
        }
      }, [selectedBuilding]);

      // Fetch messages when a collective is selected
      useEffect(() => {
        if (selectedCollective) {
          fetch(`${API_BASE}/worker-collectives/${selectedCollective}/messages`)
            .then(r => r.json())
            .then(data => setCollectiveMessages(data))
            .catch(() => {});
        }
      }, [selectedCollective]);

      // Fetch reports when filter changes
      useEffect(() => {
        const query = reportFilter !== 'all' ? `?type=${reportFilter}` : '';
        fetch(`${API_BASE}/reports${query}`)
          .then(r => r.json())
          .then(data => setReports(data))
          .catch(() => {});
      }, [reportFilter]);

      // ============================================
      // HELPERS
      // ============================================

      const showNotification = useCallback((message, type = 'success') => {
        setNotification({ message, type });
        setTimeout(() => setNotification(null), 3000);
      }, []);

      const calculateHours = (cost, wage) => Math.ceil(cost / wage);

      const handleZipSubmit = async (e) => {
        e.preventDefault();
        if (!zipCode || zipCode.length !== 5 || !/^\d{5}$/.test(zipCode)) {
          setZipError('Please enter a valid 5-digit ZIP code');
          showNotification('Invalid ZIP code format', 'error');
          return;
        }

        setLoading(true);
        setZipError(null);

        try {
          // Fetch location info from ZIP code API
          const locationInfo = await fetchZipData(zipCode);

          if (!locationInfo) {
            setZipError('ZIP code not found. Please check and try again.');
            showNotification('ZIP code not found', 'error');
            setLoading(false);
            return;
          }

          // Calculate local cost data
          const data = calculateLocalData(zipCode, locationInfo);
          setLocalData(data);
          showNotification(`Loaded data for ${data.area}`);
        } catch (error) {
          setZipError('Error fetching data. Please try again.');
          showNotification('Error loading data', 'error');
        } finally {
          setLoading(false);
        }
      };

      const handleSentimentVote = (vote) => {
        fetch(`${API_BASE}/sentiment/vote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ vote }),
        })
          .then(r => r.json())
          .then(() => {
            setWorkSentiment(vote);
            setTodaySentiment(prev => ({
              ...prev,
              [vote === 'yes' ? 'willing' : 'unwilling']: prev[vote === 'yes' ? 'willing' : 'unwilling'] + 1,
              total: prev.total + 1
            }));
            showNotification('Response recorded anonymously');
          })
          .catch(() => showNotification('Failed to record vote', 'error'));
      };

      const handlePriceVote = (itemName, threshold, itemId) => {
        fetch(`${API_BASE}/price-resistance/${itemId}/vote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ threshold: parseFloat(threshold) }),
        })
          .then(r => r.json())
          .then(() => {
            setPriceVotes({ ...priceVotes, [itemName]: threshold });
            showNotification(`Recorded: Stop buying ${itemName} at $${threshold}`);
          })
          .catch(() => showNotification('Failed to record vote', 'error'));
      };

      const handleJoinBuilding = (building) => {
        if (!joinedBuildings.includes(building.id)) {
          fetch(`${API_BASE}/buildings/${building.id}/join`, { method: 'POST' })
            .then(r => r.json())
            .then(() => {
              setJoinedBuildings([...joinedBuildings, building.id]);
              showNotification(`Joined tenant group at ${building.address}`);
            })
            .catch(() => showNotification('Failed to join', 'error'));
        }
      };

      const handleJoinCollective = (collective) => {
        if (!joinedCollectives.includes(collective.id)) {
          fetch(`${API_BASE}/worker-collectives/${collective.id}/join`, { method: 'POST' })
            .then(r => r.json())
            .then(() => {
              setJoinedCollectives([...joinedCollectives, collective.id]);
              showNotification(`Joined ${collective.company} worker collective`);
            })
            .catch(() => showNotification('Failed to join', 'error'));
        }
      };

      const handleJoinConsumerGroup = (group) => {
        if (!joinedConsumerGroups.includes(group.id)) {
          fetch(`${API_BASE}/consumer-groups/${group.id}/join`, { method: 'POST' })
            .then(r => r.json())
            .then(() => {
              setJoinedConsumerGroups([...joinedConsumerGroups, group.id]);
              showNotification(`Joined ${group.name}`);
            })
            .catch(() => showNotification('Failed to join', 'error'));
        }
      };

      const handleRefreshPetition = (petition) => {
        fetch(`${API_BASE}/petitions/${petition.id}/refresh`, { method: 'POST' })
          .then(r => r.json())
          .then(data => {
            setPetitions(petitions.map(p =>
              p.id === petition.id ? { ...p, signatures: data.signatures, goal: data.goal, status: data.status } : p
            ));
            if (data.success) {
              showNotification('Signature count updated from Change.org');
            } else {
              showNotification('Could not reach Change.org — showing cached data', 'warning');
            }
          })
          .catch(() => showNotification('Failed to refresh petition', 'error'));
      };

      const handleCreatePetition = () => {
        if (newPetition.title && newPetition.area && newPetition.changeorg_url) {
          fetch(`${API_BASE}/petitions`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newPetition),
          })
            .then(r => {
              if (!r.ok) return r.json().then(err => { throw new Error(err.error); });
              return r.json();
            })
            .then(petition => {
              setPetitions([petition, ...petitions]);
              setNewPetition({ title: '', area: '', description: '', changeorg_url: '' });
              setShowPetitionForm(false);
              showNotification('Petition created successfully');
            })
            .catch(err => showNotification(err.message || 'Failed to create petition', 'error'));
        }
      };

      const handleSubmitReport = () => {
        if (newReport.name && newReport.issues.length > 0) {
          fetch(`${API_BASE}/reports`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: reportType,
              name: newReport.name,
              address: newReport.address,
              issues: newReport.issues,
              description: newReport.description,
            }),
          })
            .then(r => r.json())
            .then(result => {
              if (result.merged) {
                setReports(reports.map(r =>
                  r.id === result.id ? { ...r, reports: result.reports, lastReport: 'Just now' } : r
                ));
                showNotification('Report added to existing record');
              } else {
                setReports([result, ...reports]);
                showNotification('Report submitted successfully');
              }
              setNewReport({ name: '', address: '', issues: [], description: '', anonymous: true });
            })
            .catch(() => showNotification('Failed to submit report', 'error'));
        }
      };

      const handleCreateCollective = () => {
        if (newCollective.company && newCollective.industry) {
          fetch(`${API_BASE}/worker-collectives`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newCollective),
          })
            .then(r => r.json())
            .then(collective => {
              if (collective.error) {
                showNotification(collective.error, 'error');
                return;
              }
              setWorkerCollectives([collective, ...workerCollectives]);
              setJoinedCollectives([...joinedCollectives, collective.id]);
              setNewCollective({ company: '', industry: '', issues: [], telegram_url: '' });
              setShowNewCollectiveForm(false);
              showNotification('Collective created - invite your coworkers!');
            })
            .catch(() => showNotification('Failed to create collective', 'error'));
        }
      };

      const handleTheftCalculate = async (e) => {
        e.preventDefault();
        const age = parseInt(theftAge, 10);
        const income = parseFloat(theftIncome);
        if (!age || age < 18 || age > 100) {
          setTheftError('Enter your age (18-100)');
          return;
        }
        if (!income || income <= 0) {
          setTheftError('Enter your annual income');
          return;
        }
        setTheftLoading(true);
        setTheftError(null);
        try {
          const params = new URLSearchParams({ age, income });
          if (zipCode && zipCode.length === 5) params.append('zip', zipCode);
          const resp = await fetch(`${API_BASE}/theft-calculator?${params}`);
          if (!resp.ok) {
            const err = await resp.json();
            throw new Error(err.error || 'Calculation failed');
          }
          const data = await resp.json();
          setTheftResults(data);
        } catch (err) {
          setTheftError(err.message || 'Failed to calculate');
          showNotification('Calculation error', 'error');
        } finally {
          setTheftLoading(false);
        }
      };

      const toggleReportIssue = (issue) => {
        setNewReport(prev => ({
          ...prev,
          issues: prev.issues.includes(issue)
            ? prev.issues.filter(i => i !== issue)
            : [...prev.issues, issue]
        }));
      };

      const toggleCollectiveIssue = (issue) => {
        setNewCollective(prev => ({
          ...prev,
          issues: prev.issues.includes(issue)
            ? prev.issues.filter(i => i !== issue)
            : [...prev.issues, issue]
        }));
      };

      // ============================================
      // MODERATION FUNCTIONS
      // ============================================

      const verifyModerationKey = async () => {
        try {
          const res = await fetch(`${API_BASE}/moderation/verify`, {
            method: 'POST',
            headers: { 'x-admin-key': moderationKey },
          });
          const data = await res.json();
          if (data.valid) {
            setIsModeratorAuthenticated(true);
            localStorage.setItem('solidaritynet_adminKey', moderationKey);
            loadModerationContent();
          } else {
            showNotification('Invalid admin key', 'error');
          }
        } catch {
          showNotification('Failed to verify key', 'error');
        }
      };

      const loadModerationContent = async () => {
        setModerationLoading(true);
        try {
          const res = await fetch(`${API_BASE}/moderation/content`, {
            headers: { 'x-admin-key': moderationKey || localStorage.getItem('solidaritynet_adminKey') },
          });
          if (res.ok) {
            const data = await res.json();
            setModerationContent(data);
          } else {
            setIsModeratorAuthenticated(false);
            localStorage.removeItem('solidaritynet_adminKey');
          }
        } catch {
          showNotification('Failed to load moderation content', 'error');
        }
        setModerationLoading(false);
      };

      const moderationDelete = async (type, id) => {
        if (!confirm('Are you sure you want to delete this content?')) return;
        try {
          const res = await fetch(`${API_BASE}/moderation/${type}/${id}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json',
              'x-admin-key': localStorage.getItem('solidaritynet_adminKey'),
            },
            body: JSON.stringify({ reason: deleteReason }),
          });
          if (res.ok) {
            showNotification('Content deleted');
            setDeleteReason('');
            loadModerationContent();
            // Refresh main content
            if (type.includes('collective')) {
              fetch(`${API_BASE}/worker-collectives`).then(r => r.json()).then(setWorkerCollectives);
            } else if (type.includes('petition')) {
              fetch(`${API_BASE}/petitions`).then(r => r.json()).then(setPetitions);
            } else if (type.includes('report')) {
              fetch(`${API_BASE}/reports`).then(r => r.json()).then(setReports);
            }
          } else {
            showNotification('Failed to delete', 'error');
          }
        } catch {
          showNotification('Failed to delete', 'error');
        }
      };

      const moderationBan = async () => {
        if (!banAuthor.name) {
          showNotification('Author name required', 'error');
          return;
        }
        try {
          const res = await fetch(`${API_BASE}/moderation/ban`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-admin-key': localStorage.getItem('solidaritynet_adminKey'),
            },
            body: JSON.stringify({ author_name: banAuthor.name, reason: banAuthor.reason }),
          });
          if (res.ok) {
            showNotification('Author banned');
            setBanAuthor({ name: '', reason: '' });
            loadModerationContent();
          } else {
            const data = await res.json();
            showNotification(data.error || 'Failed to ban', 'error');
          }
        } catch {
          showNotification('Failed to ban', 'error');
        }
      };

      const moderationUnban = async (id) => {
        try {
          const res = await fetch(`${API_BASE}/moderation/ban/${id}`, {
            method: 'DELETE',
            headers: { 'x-admin-key': localStorage.getItem('solidaritynet_adminKey') },
          });
          if (res.ok) {
            showNotification('Author unbanned');
            loadModerationContent();
          }
        } catch {
          showNotification('Failed to unban', 'error');
        }
      };

      const moderationTogglePin = async (type, id) => {
        try {
          const res = await fetch(`${API_BASE}/moderation/pin/${type}/${id}`, {
            method: 'POST',
            headers: { 'x-admin-key': localStorage.getItem('solidaritynet_adminKey') },
          });
          if (res.ok) {
            showNotification('Pin status updated');
            loadModerationContent();
          }
        } catch {
          showNotification('Failed to update pin', 'error');
        }
      };

      // Auto-verify saved admin key
      useEffect(() => {
        const savedKey = localStorage.getItem('solidaritynet_adminKey');
        if (savedKey && showModerationPanel && !isModeratorAuthenticated) {
          setModerationKey(savedKey);
          fetch(`${API_BASE}/moderation/verify`, {
            method: 'POST',
            headers: { 'x-admin-key': savedKey },
          })
            .then(r => r.json())
            .then(data => {
              if (data.valid) {
                setIsModeratorAuthenticated(true);
                loadModerationContent();
              }
            })
            .catch(() => {});
        }
      }, [showModerationPanel]);

      // Calculations (using after-tax net wage)
      const effectiveWage = localData ? localData.netWage : 0;
      const totalMonthlyHours = localData ?
        calculateHours(localData.rent, effectiveWage) +
        calculateHours(localData.food, effectiveWage) +
        calculateHours(localData.healthcare, effectiveWage) +
        calculateHours(localData.transport, effectiveWage) +
        calculateHours(localData.utilities, effectiveWage) : 0;

      const availableHours = 160;
      const deficit = availableHours - totalMonthlyHours;
      const weeksToAffordMonth = localData ? (totalMonthlyHours / 40).toFixed(1) : 0;

      // ============================================
      // STYLES
      // ============================================

      const colors = {
        bg: colorConfig.bg || '#0a0a0a',
        bgLight: colorConfig.bgLight || '#111',
        bgLighter: '#1a1a1a',
        border: colorConfig.border || '#222',
        borderLight: '#333',
        text: colorConfig.text || '#e8e8e8',
        textMuted: colorConfig.textMuted || '#888',
        textDim: colorConfig.textDim || '#666',
        textDimmer: '#555',
        textDimmest: '#444',
        primary: colorConfig.primary || '#ff3333',
        primaryDark: '#cc2929',
        success: colorConfig.success || '#33ff33',
        successDark: '#29cc29',
        warning: colorConfig.warning || '#ffaa00',
        purple: '#aa00ff',
      };

      const styles = {
        container: {
          minHeight: '100vh',
          backgroundColor: colors.bg,
          color: colors.text,
          fontFamily: fontConfig.primary || "'IBM Plex Mono', 'Courier New', monospace",
          fontSize: '14px',
          lineHeight: '1.6'
        },
        header: {
          borderBottom: `2px solid ${colors.primary}`,
          padding: '20px 40px',
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          flexWrap: 'wrap',
          gap: '15px'
        },
        nav: {
          display: 'flex',
          borderBottom: `1px solid ${colors.border}`,
          backgroundColor: colors.bgLight
        },
        navButton: (active) => ({
          flex: 1,
          padding: '16px 20px',
          backgroundColor: active ? colors.bgLighter : 'transparent',
          color: active ? colors.primary : colors.textDim,
          border: 'none',
          borderBottom: active ? `2px solid ${colors.primary}` : '2px solid transparent',
          cursor: 'pointer',
          fontFamily: 'inherit',
          fontSize: '12px',
          textTransform: 'uppercase',
          letterSpacing: '2px',
          fontWeight: active ? 700 : 400,
          transition: 'all 0.2s'
        }),
        subNav: {
          display: 'flex',
          gap: '10px',
          marginBottom: '30px',
          flexWrap: 'wrap'
        },
        subNavButton: (active) => ({
          padding: '10px 15px',
          backgroundColor: active ? colors.primary : 'transparent',
          color: active ? '#000' : colors.textMuted,
          border: `1px solid ${active ? colors.primary : colors.borderLight}`,
          cursor: 'pointer',
          fontFamily: 'inherit',
          fontSize: '11px',
          textTransform: 'uppercase',
          letterSpacing: '1px',
          transition: 'all 0.15s'
        }),
        main: {
          padding: '40px',
          maxWidth: '1200px',
          margin: '0 auto'
        },
        sectionHeader: {
          fontSize: '11px',
          color: colors.textDimmer,
          textTransform: 'uppercase',
          letterSpacing: '3px',
          marginBottom: '20px',
          borderBottom: `1px solid ${colors.border}`,
          paddingBottom: '10px'
        },
        card: {
          backgroundColor: colors.bgLight,
          border: `1px solid ${colors.border}`,
          padding: '25px',
          marginBottom: '15px'
        },
        input: {
          backgroundColor: colors.bgLighter,
          border: `1px solid ${colors.borderLight}`,
          color: '#fff',
          padding: '12px',
          fontFamily: 'inherit',
          fontSize: '14px',
          width: '100%',
          boxSizing: 'border-box'
        },
        button: (variant = 'primary') => ({
          padding: '12px 20px',
          backgroundColor: variant === 'primary' ? colors.primary : 'transparent',
          color: variant === 'primary' ? '#000' : colors.primary,
          border: variant === 'primary' ? 'none' : `1px solid ${colors.primary}`,
          cursor: 'pointer',
          fontFamily: 'inherit',
          fontWeight: 700,
          textTransform: 'uppercase',
          letterSpacing: '1px',
          fontSize: '11px',
          transition: 'all 0.15s'
        }),
        badge: (color) => ({
          display: 'inline-block',
          padding: '3px 8px',
          backgroundColor: `${color}20`,
          color: color,
          fontSize: '10px',
          textTransform: 'uppercase',
          marginRight: '8px'
        }),
        grid: {
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',
          gap: '15px'
        },
        modal: {
          position: 'fixed',
          inset: 0,
          backgroundColor: 'rgba(0,0,0,0.9)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000,
          padding: '20px'
        },
        notification: (type) => ({
          position: 'fixed',
          top: '20px',
          right: '20px',
          padding: '15px 25px',
          backgroundColor: type === 'success' ? '#1a3d1a' : '#3d1a1a',
          border: `1px solid ${type === 'success' ? colors.success : colors.primary}`,
          color: type === 'success' ? colors.success : colors.primary,
          zIndex: 1001,
          fontFamily: 'inherit',
          fontSize: '12px',
          maxWidth: '300px'
        })
      };

      // ============================================
      // RENDER
      // ============================================

      return (
        <div style={styles.container}>
          {/* Notification */}
          {notification && (
            <div style={styles.notification(notification.type)} className="notification-enter">
              {notification.message}
            </div>
          )}

          {/* Header */}
          <header style={styles.header}>
            <div>
              <h1 style={{ margin: 0, fontSize: '24px', fontWeight: 700, letterSpacing: '-0.5px', color: '#ffffff', fontFamily: fontConfig.heading }}>
                {textConfig.header_title}<span style={{ color: colors.primary }}>_</span>{textConfig.header_title_suffix}
              </h1>
              <p style={{ margin: '4px 0 0 0', fontSize: '11px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '2px' }}>
                {textConfig.header_tagline}
              </p>
            </div>
            <div style={{ fontSize: '11px', color: colors.textDimmer, textAlign: 'right' }}>
              <div>{textConfig.header_no_tracking}</div>
              <div style={{ color: colors.primary, marginTop: '4px' }}>{textConfig.header_workers_first}</div>
            </div>
          </header>

          {/* Navigation */}
          <nav style={styles.nav}>
            {[
              { key: 'information', label: textConfig.nav_information },
              { key: 'formation', label: textConfig.nav_formation },
              { key: 'accountability', label: textConfig.nav_accountability }
            ].map(tab => (
              <button
                key={tab.key}
                onClick={() => { setActiveTab(tab.key); if (tab.key === 'formation') setActiveSubTab('sentiment'); }}
                style={styles.navButton(activeTab === tab.key)}
              >
                {tab.label}
              </button>
            ))}
          </nav>

          {/* Main Content */}
          <main style={styles.main}>

            {/* ==================== INFORMATION TAB ==================== */}
            {activeTab === 'information' && (
              <div>
                {/* Standard of Living Calculator */}
                <section style={{ marginBottom: '60px' }}>
                  <h2 style={styles.sectionHeader}>{textConfig.sol_section_title}</h2>

                  <form onSubmit={handleZipSubmit} style={{ marginBottom: '30px' }}>
                    <div style={{ display: 'flex', gap: '10px', alignItems: 'center', flexWrap: 'wrap' }}>
                      <label style={{ color: colors.textMuted }}>{textConfig.sol_zip_label}</label>
                      <input
                        type="text"
                        value={zipCode}
                        onChange={(e) => {
                          setZipCode(e.target.value.replace(/\D/g, '').slice(0, 5));
                          setZipError(null);
                        }}
                        placeholder={textConfig.sol_zip_placeholder}
                        maxLength={5}
                        style={{
                          ...styles.input,
                          width: '120px',
                          borderColor: zipError ? colors.primary : colors.borderLight
                        }}
                        disabled={loading}
                      />
                      <button
                        type="submit"
                        style={{
                          ...styles.button('primary'),
                          opacity: loading ? 0.7 : 1,
                          cursor: loading ? 'wait' : 'pointer'
                        }}
                        disabled={loading}
                      >
                        {loading ? textConfig.sol_loading_btn : textConfig.sol_calculate_btn}
                      </button>
                    </div>
                    {zipError && (
                      <p style={{ fontSize: '12px', color: colors.primary, marginTop: '8px' }}>
                        {zipError}
                      </p>
                    )}
                    <p style={{ fontSize: '11px', color: colors.textDimmest, marginTop: '8px' }}>
                      {textConfig.sol_helper_text}
                    </p>
                  </form>

                  {localData && (
                    <div style={styles.card}>
                      {/* Key Metric */}
                      <div style={{
                        textAlign: 'center',
                        padding: '30px',
                        marginBottom: '30px',
                        backgroundColor: deficit < 0 ? '#1a0505' : '#051a05',
                        border: `2px solid ${deficit < 0 ? colors.primary : colors.success}`
                      }}>
                        <div style={{ fontSize: '11px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '2px', marginBottom: '10px' }}>
                          {localData.area}
                        </div>
                        <div style={{ fontSize: '72px', fontWeight: 700, color: deficit < 0 ? colors.primary : colors.success, lineHeight: 1 }}>
                          {weeksToAffordMonth}
                        </div>
                        <div style={{ fontSize: '14px', color: colors.textMuted, marginTop: '10px' }}>
                          {textConfig.sol_weeks_label}
                        </div>
                        {deficit < 0 && (
                          <div style={{ marginTop: '15px', padding: '12px', backgroundColor: '#ff333320', color: '#ff6666', fontSize: '12px' }}>
                            ⚠ {textConfig.sol_deficit_label} <strong>{Math.abs(deficit)} </strong>{textConfig.sol_deficit_suffix}
                          </div>
                        )}
                        {deficit >= 0 && (
                          <div style={{ marginTop: '15px', padding: '12px', backgroundColor: '#33ff3320', color: '#66ff66', fontSize: '12px' }}>
                            ✓ {textConfig.sol_surplus_prefix} {deficit} {textConfig.sol_surplus_suffix}
                          </div>
                        )}
                      </div>

                      {/* Wage & Tax Breakdown */}
                      <div style={{ padding: '15px 0', borderBottom: `1px solid ${colors.border}`, marginBottom: '15px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                          <span style={{ color: colors.textMuted }}>{textConfig.sol_gross_wage}</span>
                          <span style={{ fontWeight: 700, fontSize: '18px' }}>${localData.medianWage.toFixed(2)}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                          <span style={{ color: colors.textDimmer, fontSize: '12px', paddingLeft: '10px' }}>{textConfig.sol_federal_tax}</span>
                          <span style={{ color: colors.textDim, fontSize: '12px' }}>-${(localData.taxData.federalTax / 2080).toFixed(2)}/hr</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                          <span style={{ color: colors.textDimmer, fontSize: '12px', paddingLeft: '10px' }}>{textConfig.sol_state_tax} ({localData.taxData.stateCode})</span>
                          <span style={{ color: colors.textDim, fontSize: '12px' }}>-${(localData.taxData.stateTax / 2080).toFixed(2)}/hr</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                          <span style={{ color: colors.textDimmer, fontSize: '12px', paddingLeft: '10px' }}>{textConfig.sol_fica}</span>
                          <span style={{ color: colors.textDim, fontSize: '12px' }}>-${(localData.taxData.ficaTax / 2080).toFixed(2)}/hr</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '8px 0', borderTop: `1px dashed ${colors.border}` }}>
                          <span style={{ color: colors.warning, fontWeight: 700 }}>{textConfig.sol_after_tax}</span>
                          <span style={{ fontWeight: 700, fontSize: '18px', color: colors.warning }}>${localData.netWage.toFixed(2)}</span>
                        </div>
                        <div style={{ textAlign: 'right', fontSize: '11px', color: colors.textDimmest }}>
                          {textConfig.sol_effective_rate} {(localData.taxData.effectiveRate * 100).toFixed(1)}%
                        </div>
                      </div>

                      <div style={{ fontSize: '11px', color: colors.textDimmer, marginBottom: '10px', textTransform: 'uppercase', letterSpacing: '1px' }}>
                        {textConfig.sol_hours_label}
                      </div>

                      {[
                        { label: textConfig.sol_rent, cost: localData.rent, icon: '🏠' },
                        { label: textConfig.sol_food, cost: localData.food, icon: '🍎' },
                        { label: textConfig.sol_healthcare, cost: localData.healthcare, icon: '🏥' },
                        { label: textConfig.sol_transport, cost: localData.transport, icon: '🚗' },
                        { label: textConfig.sol_utilities, cost: localData.utilities, icon: '💡' },
                      ].map(item => {
                        const hours = calculateHours(item.cost, effectiveWage);
                        const pct = (hours / totalMonthlyHours) * 100;
                        return (
                          <div key={item.label} style={{ marginBottom: '12px' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>
                              <span style={{ color: colors.textMuted }}>{item.icon} {item.label}</span>
                              <div style={{ display: 'flex', gap: '20px', alignItems: 'center' }}>
                                <span style={{ color: colors.textDimmer, fontSize: '12px' }}>${item.cost}</span>
                                <span style={{ color: '#fff', fontWeight: 700, minWidth: '70px', textAlign: 'right' }}>
                                  {hours} hrs
                                </span>
                              </div>
                            </div>
                            <div style={{ height: '4px', backgroundColor: colors.border, borderRadius: '2px' }}>
                              <div style={{ height: '100%', width: `${pct}%`, backgroundColor: colors.primary, borderRadius: '2px' }} />
                            </div>
                          </div>
                        );
                      })}

                      <div style={{ display: 'flex', justifyContent: 'space-between', padding: '15px 0', borderTop: `2px solid ${colors.borderLight}`, marginTop: '15px' }}>
                        <span style={{ fontWeight: 700 }}>TOTAL REQUIRED</span>
                        <span style={{ fontWeight: 700, color: colors.primary, fontSize: '18px' }}>{totalMonthlyHours} hrs</span>
                      </div>

                      <div style={{ display: 'flex', justifyContent: 'space-between', padding: '10px 0', color: colors.textDim }}>
                        <span>Available (40hr/wk × 4)</span>
                        <span>{availableHours} hrs</span>
                      </div>

                      <div style={{ display: 'flex', justifyContent: 'space-between', padding: '10px 0', fontWeight: 700, fontSize: '16px', color: deficit < 0 ? colors.primary : colors.success }}>
                        <span>{deficit < 0 ? 'MONTHLY DEFICIT' : 'MONTHLY SURPLUS'}</span>
                        <span>{deficit} hrs</span>
                      </div>

                      <div style={{ marginTop: '20px', padding: '15px', backgroundColor: colors.bg, fontSize: '11px', color: colors.textDimmest }}>
                        <div style={{ marginBottom: '8px' }}>
                          <strong>Data quality:</strong>{' '}
                          <span style={{ color: localData.msa ? colors.success : colors.warning }}>
                            {localData.dataQuality}
                          </span>
                          {localData.msa && (
                            <span style={{ color: colors.textDimmer }}> — {localData.msa}</span>
                          )}
                        </div>
                        <strong>Sources:</strong> BLS OEWS Q3 2024 (wages), HUD FMR FY2024 (housing), USDA Thrifty Food Plan (food), Healthcare.gov (insurance), AAA (transport), EIA (utilities), IRS 2024 brackets (federal tax), Tax Foundation 2024 (state tax), SSA (FICA)
                      </div>
                    </div>
                  )}

                  {loading && (
                    <div style={{
                      ...styles.card,
                      textAlign: 'center',
                      padding: '60px'
                    }}>
                      <div style={{ fontSize: '24px', marginBottom: '15px' }}>⏳</div>
                      <div style={{ color: colors.textMuted }}>Loading data for ZIP {zipCode}...</div>
                    </div>
                  )}
                </section>

                {/* Economic Theft Calculator */}
                <section style={{ marginBottom: '60px' }}>
                  <h2 style={styles.sectionHeader}>{textConfig.theft_section_title}</h2>
                  <p style={{ color: colors.textDim, marginBottom: '20px', fontSize: '13px' }}>
                    {textConfig.theft_description}
                  </p>

                  <form onSubmit={handleTheftCalculate} style={{ marginBottom: '30px' }}>
                    <div style={{ display: 'flex', gap: '10px', alignItems: 'center', flexWrap: 'wrap' }}>
                      <label style={{ color: colors.textMuted }}>{textConfig.theft_age_label}</label>
                      <input
                        type="number"
                        value={theftAge}
                        onChange={(e) => { setTheftAge(e.target.value); setTheftError(null); }}
                        placeholder={textConfig.theft_age_placeholder}
                        min={18}
                        max={100}
                        style={{ ...styles.input, width: '80px' }}
                        disabled={theftLoading}
                      />
                      <label style={{ color: colors.textMuted }}>{textConfig.theft_income_label}</label>
                      <input
                        type="number"
                        value={theftIncome}
                        onChange={(e) => { setTheftIncome(e.target.value); setTheftError(null); }}
                        placeholder={textConfig.theft_income_placeholder}
                        min={1}
                        style={{ ...styles.input, width: '140px' }}
                        disabled={theftLoading}
                      />
                      <button
                        type="submit"
                        style={{
                          ...styles.button('primary'),
                          opacity: theftLoading ? 0.7 : 1,
                          cursor: theftLoading ? 'wait' : 'pointer'
                        }}
                        disabled={theftLoading}
                      >
                        {theftLoading ? textConfig.sol_loading_btn : textConfig.theft_calculate_btn}
                      </button>
                    </div>
                    {theftError && (
                      <p style={{ fontSize: '12px', color: colors.primary, marginTop: '8px' }}>{theftError}</p>
                    )}
                    <p style={{ fontSize: '11px', color: colors.textDimmest, marginTop: '8px' }}>
                      Compares your lifetime economics against 1980s baselines — data from EPI, Federal Reserve, Census Bureau, HUD, BLS
                    </p>
                  </form>

                  {theftResults && (
                    <div>
                      {/* Hero total */}
                      <div style={{
                        textAlign: 'center',
                        padding: '40px 30px',
                        marginBottom: '20px',
                        backgroundColor: '#1a0505',
                        border: `2px solid ${colors.primary}`
                      }}>
                        <div style={{ fontSize: '11px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '2px', marginBottom: '10px' }}>
                          Total stolen from you over {theftResults.totals.workingYears} working years
                        </div>
                        <div style={{ fontSize: '64px', fontWeight: 700, color: colors.primary, lineHeight: 1 }}>
                          ${theftResults.totals.lifetimeTheft.toLocaleString()}
                        </div>
                        <div style={{ fontSize: '14px', color: colors.textMuted, marginTop: '12px' }}>
                          That is <strong style={{ color: colors.primary, fontSize: '18px' }}>{theftResults.totals.yearsOfWorkStolen}</strong> full years of your labor — gone.
                        </div>
                        {theftResults.totals.yearsToRetirement > 0 && (
                          <div style={{ marginTop: '15px', padding: '12px', backgroundColor: '#ff333315', color: '#ff6666', fontSize: '12px' }}>
                            At this rate, another <strong>${theftResults.totals.projectedFutureTheft.toLocaleString()}</strong> will be extracted before you reach 65.
                          </div>
                        )}
                      </div>

                      {/* Housing — years-based, not dollars */}
                      {(() => {
                        const h = theftResults.metrics.housing;
                        return (
                          <div style={{
                            ...styles.card,
                            display: 'flex',
                            alignItems: 'center',
                            gap: '30px',
                            padding: '25px',
                            marginBottom: '15px',
                            borderLeft: `3px solid ${colors.textMuted}`,
                            flexWrap: 'wrap'
                          }}>
                            <div style={{ flex: '1 1 auto' }}>
                              <div style={{ fontSize: '10px', color: colors.textDimmer, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>
                                {h.label}
                              </div>
                              <div style={{ fontSize: '11px', color: colors.textDim }}>
                                {h.detail}
                              </div>
                            </div>
                            <div style={{ display: 'flex', gap: '20px', alignItems: 'baseline', flexShrink: 0 }}>
                              <div style={{ textAlign: 'center' }}>
                                <div style={{ fontSize: '10px', color: colors.textDimmer, marginBottom: '4px' }}>1985</div>
                                <div style={{ fontSize: '24px', fontWeight: 700, color: colors.success }}>{h.yearsIn1985}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmest }}>years</div>
                              </div>
                              <div style={{ fontSize: '18px', color: colors.textDimmer }}>&rarr;</div>
                              <div style={{ textAlign: 'center' }}>
                                <div style={{ fontSize: '10px', color: colors.textDimmer, marginBottom: '4px' }}>NOW</div>
                                <div style={{ fontSize: '24px', fontWeight: 700, color: colors.primary }}>{h.yearsNow}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmest }}>years</div>
                              </div>
                              <div style={{ textAlign: 'center', padding: '8px 12px', backgroundColor: '#ff333315', marginLeft: '5px' }}>
                                <div style={{ fontSize: '10px', color: colors.textDimmer, marginBottom: '4px' }}>EXTRA</div>
                                <div style={{ fontSize: '24px', fontWeight: 700, color: colors.primary }}>+{h.extraYears}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmest }}>years of work</div>
                              </div>
                            </div>
                          </div>
                        );
                      })()}

                      {/* 3 Dollar-based Metric Cards */}
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '15px', marginBottom: '20px' }}>
                        {[
                          { key: 'earnings', icon: '\u25B2', color: colors.warning },
                          { key: 'debt', icon: '\u25CF', color: colors.purple },
                          { key: 'rent', icon: '\u25AC', color: '#ff6644' },
                        ].map(({ key, icon, color }) => {
                          const m = theftResults.metrics[key];
                          const pct = theftResults.totals.lifetimeTheft > 0
                            ? Math.round((m.amount / theftResults.totals.lifetimeTheft) * 100)
                            : 0;
                          return (
                            <div key={key} style={{
                              ...styles.card,
                              borderLeft: `3px solid ${color}`,
                              padding: '20px'
                            }}>
                              <div style={{ fontSize: '10px', color: colors.textDimmer, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>
                                {icon} {m.label}
                              </div>
                              <div style={{ fontSize: '28px', fontWeight: 700, color: color, marginBottom: '8px' }}>
                                ${m.amount.toLocaleString()}
                              </div>
                              {m.annualAmount && (
                                <div style={{ fontSize: '11px', color: colors.textMuted, marginBottom: '6px' }}>
                                  ${m.annualAmount.toLocaleString()}/year
                                </div>
                              )}
                              <div style={{ height: '4px', backgroundColor: colors.border, borderRadius: '2px', marginBottom: '8px' }}>
                                <div style={{ height: '100%', width: `${pct}%`, backgroundColor: color, borderRadius: '2px', transition: 'width 0.5s' }} />
                              </div>
                              <div style={{ fontSize: '11px', color: colors.textDim }}>
                                {m.detail}
                              </div>
                              <div style={{ fontSize: '10px', color: colors.textDimmest, marginTop: '4px' }}>
                                {pct}% of total theft
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* CTA to organize */}
                      <div style={{
                        ...styles.card,
                        textAlign: 'center',
                        borderColor: colors.primary,
                        padding: '30px'
                      }}>
                        <div style={{ fontSize: '16px', fontWeight: 700, color: colors.text, marginBottom: '10px' }}>
                          This is not inevitable. It is policy. Policy can be changed.
                        </div>
                        <div style={{ fontSize: '12px', color: colors.textMuted, marginBottom: '20px' }}>
                          Join a worker collective, tenant union, or consumer group to start fighting back.
                        </div>
                        <button
                          onClick={() => { setActiveTab('formation'); setActiveSubTab('worker'); }}
                          style={{
                            ...styles.button('primary'),
                            padding: '14px 30px',
                            fontSize: '13px'
                          }}
                        >
                          Organize Now
                        </button>
                      </div>

                      {/* Sources */}
                      <div style={{ marginTop: '15px', padding: '15px', backgroundColor: colors.bg, fontSize: '11px', color: colors.textDimmest }}>
                        <strong>Sources:</strong> {theftResults.sources.join(' • ')}
                      </div>
                    </div>
                  )}

                  {theftLoading && (
                    <div style={{ ...styles.card, textAlign: 'center', padding: '60px' }}>
                      <div style={{ fontSize: '24px', marginBottom: '15px' }}>...</div>
                      <div style={{ color: colors.textMuted }}>Calculating your personal economic data...</div>
                    </div>
                  )}
                </section>

                {/* Price Resistance */}
                <section>
                  <h2 style={styles.sectionHeader}>Consumer Price Resistance</h2>
                  <p style={{ color: colors.textDim, marginBottom: '20px' }}>
                    "At what price do you stop buying?" — Click to set your threshold
                  </p>

                  <div style={styles.grid}>
                    {priceResistanceItems.map(item => (
                      <div key={item.id} style={styles.card}>
                        <div style={{ fontSize: '13px', color: colors.textMuted, marginBottom: '12px', fontWeight: 500 }}>{item.item}</div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '15px' }}>
                          <div>
                            <div style={{ fontSize: '10px', color: colors.textDimmer }}>CURRENT</div>
                            <div style={{ fontSize: '20px', fontWeight: 700 }}>
                              ${item.current < 10 ? item.current.toFixed(2) : item.current}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '10px', color: colors.textDimmer }}>COMMUNITY THRESHOLD</div>
                            <div style={{ fontSize: '20px', fontWeight: 700, color: colors.primary }}>
                              ${item.resistance < 10 ? item.resistance.toFixed(2) : item.resistance}
                            </div>
                          </div>
                        </div>

                        <div style={{ height: '6px', backgroundColor: colors.border, borderRadius: '3px', marginBottom: '8px' }}>
                          <div style={{ height: '100%', width: `${item.atResistance}%`, backgroundColor: colors.primary, borderRadius: '3px', transition: 'width 0.3s' }} />
                        </div>
                        <div style={{ fontSize: '10px', color: colors.textDimmer, marginBottom: '15px' }}>
                          {item.atResistance}% of {item.votes.toLocaleString()} people at resistance
                        </div>

                        <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                          {[1.15, 1.3, 1.5, 2].map(mult => {
                            const threshold = (item.current * mult).toFixed(2);
                            const isSelected = priceVotes[item.item] === threshold;
                            return (
                              <button
                                key={mult}
                                onClick={() => handlePriceVote(item.item, threshold, item.id)}
                                style={{
                                  padding: '8px 12px',
                                  backgroundColor: isSelected ? colors.primary : colors.bgLighter,
                                  color: isSelected ? '#000' : colors.textMuted,
                                  border: `1px solid ${isSelected ? colors.primary : colors.borderLight}`,
                                  cursor: 'pointer',
                                  fontFamily: 'inherit',
                                  fontSize: '11px',
                                  fontWeight: isSelected ? 700 : 400
                                }}
                              >
                                ${threshold}
                              </button>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>
                </section>
              </div>
            )}

            {/* ==================== FORMATION TAB ==================== */}
            {activeTab === 'formation' && (
              <div>
                <div style={styles.subNav}>
                  {[
                    { id: 'sentiment', label: textConfig.subtab_sentiment },
                    { id: 'tenant', label: textConfig.subtab_tenant },
                    { id: 'worker', label: textConfig.subtab_worker },
                    { id: 'consumer', label: textConfig.subtab_consumer },
                    { id: 'petition', label: textConfig.subtab_petitions }
                  ].map(sub => (
                    <button key={sub.id} onClick={() => setActiveSubTab(sub.id)} style={styles.subNavButton(activeSubTab === sub.id)}>
                      {sub.label}
                    </button>
                  ))}
                </div>

                {/* Work Sentiment */}
                {activeSubTab === 'sentiment' && (
                  <section>
                    <h2 style={styles.sectionHeader}>{textConfig.sentiment_section_title}</h2>

                    <div style={styles.card}>
                      <p style={{ color: colors.textMuted, marginBottom: '25px', textAlign: 'center', fontSize: '16px' }}>
                        {textConfig.sentiment_question}
                      </p>
                      <div style={{ display: 'flex', gap: '20px', justifyContent: 'center', marginBottom: '30px' }}>
                        {['yes', 'no'].map(vote => (
                          <button
                            key={vote}
                            onClick={() => !workSentiment && handleSentimentVote(vote)}
                            disabled={workSentiment !== null}
                            style={{
                              padding: '25px 50px',
                              backgroundColor: workSentiment === vote ? (vote === 'yes' ? colors.success : colors.primary) : colors.bgLighter,
                              color: workSentiment === vote ? '#000' : (vote === 'yes' ? colors.success : colors.primary),
                              border: `2px solid ${vote === 'yes' ? colors.success : colors.primary}`,
                              cursor: workSentiment ? 'default' : 'pointer',
                              opacity: workSentiment && workSentiment !== vote ? 0.4 : 1,
                              fontFamily: 'inherit',
                              fontWeight: 700,
                              fontSize: '18px',
                              transition: 'all 0.15s'
                            }}
                          >
                            {vote === 'yes' ? textConfig.sentiment_yes : textConfig.sentiment_no}
                          </button>
                        ))}
                      </div>

                      {workSentiment && (
                        <div style={{ textAlign: 'center', marginBottom: '25px', fontSize: '12px', color: colors.success }}>
                          ✓ {textConfig.sentiment_recorded}
                        </div>
                      )}

                      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', textAlign: 'center', marginBottom: '30px' }}>
                        <div style={{ padding: '25px', backgroundColor: colors.bg }}>
                          <div style={{ fontSize: '56px', fontWeight: 700, color: colors.primary }}>
                            {Math.round((todaySentiment.unwilling / todaySentiment.total) * 100)}%
                          </div>
                          <div style={{ fontSize: '11px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '1px' }}>
                            {textConfig.sentiment_unwilling}
                          </div>
                        </div>
                        <div style={{ padding: '25px', backgroundColor: colors.bg }}>
                          <div style={{ fontSize: '56px', fontWeight: 700, color: colors.textMuted }}>
                            {todaySentiment.total}
                          </div>
                          <div style={{ fontSize: '11px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '1px' }}>
                            {textConfig.sentiment_responses}
                          </div>
                        </div>
                      </div>

                      {/* Trend */}
                      <div>
                        <div style={{ fontSize: '10px', color: colors.textDimmer, textTransform: 'uppercase', marginBottom: '15px' }}>
                          {textConfig.sentiment_trend}
                        </div>
                        <div style={{ display: 'flex', alignItems: 'flex-end', height: '120px', gap: '15px' }}>
                          {sentimentHistory.map((week, i) => (
                            <div key={week.week} style={{ flex: 1, textAlign: 'center' }}>
                              <div style={{
                                height: `${week.unwilling * 1.5}px`,
                                backgroundColor: i === sentimentHistory.length - 1 ? colors.primary : colors.borderLight,
                                marginBottom: '8px',
                                transition: 'height 0.3s',
                                borderRadius: '2px 2px 0 0'
                              }} />
                              <div style={{ fontSize: '11px', color: colors.textDimmer }}>{week.week}</div>
                              <div style={{ fontSize: '13px', color: colors.textMuted, fontWeight: 500 }}>{week.unwilling}%</div>
                            </div>
                          ))}
                        </div>
                        <div style={{ marginTop: '20px', fontSize: '13px', color: colors.primary, textAlign: 'center' }}>
                          ↑ Worker unwillingness rising 14 points over 4 weeks
                        </div>
                      </div>
                    </div>
                  </section>
                )}

                {/* Tenant Unions */}
                {activeSubTab === 'tenant' && (
                  <section>
                    <h2 style={styles.sectionHeader}>Tenant Union Builder</h2>
                    <p style={{ color: colors.textDim, marginBottom: '20px' }}>
                      Find and connect with other tenants in your building. No personal data required.
                    </p>

                    <div style={{ display: 'flex', gap: '10px', marginBottom: '25px', flexWrap: 'wrap' }}>
                      <input
                        type="text"
                        value={zipCode}
                        onChange={(e) => setZipCode(e.target.value)}
                        placeholder="Enter ZIP to find buildings"
                        style={{ ...styles.input, width: '200px' }}
                      />
                      <button onClick={() => { fetchBuildings(zipCode); showNotification(`Showing buildings in ${zipCode || 'your area'}`); }} style={styles.button('secondary')}>
                        Search Buildings
                      </button>
                    </div>

                    <div style={styles.grid}>
                      {buildings.map(building => {
                        const joined = joinedBuildings.includes(building.id);
                        const orgPct = Math.round((building.members / building.units) * 100);
                        return (
                          <div key={building.id} style={{
                            ...styles.card,
                            border: joined ? `1px solid ${colors.success}` : `1px solid ${colors.border}`
                          }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                              <div>
                                <div style={{ fontWeight: 700, marginBottom: '4px' }}>{building.address}</div>
                                <div style={{ fontSize: '12px', color: colors.textDim }}>Landlord: {building.landlord}</div>
                              </div>
                              {joined && <span style={styles.badge(colors.success)}>Joined</span>}
                            </div>

                            {building.issues.length > 0 && (
                              <div style={{ marginBottom: '12px' }}>
                                {building.issues.map(issue => (
                                  <span key={issue} style={{ ...styles.badge(colors.warning), marginBottom: '4px' }}>{issue}</span>
                                ))}
                              </div>
                            )}

                            <div style={{ display: 'flex', gap: '25px', marginBottom: '15px' }}>
                              <div>
                                <div style={{ fontSize: '28px', fontWeight: 700 }}>{building.members}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmer }}>MEMBERS</div>
                              </div>
                              <div>
                                <div style={{ fontSize: '28px', fontWeight: 700, color: colors.textDim }}>{building.units}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmer }}>UNITS</div>
                              </div>
                              <div>
                                <div style={{ fontSize: '28px', fontWeight: 700, color: orgPct > 30 ? colors.success : colors.primary }}>
                                  {orgPct}%
                                </div>
                                <div style={{ fontSize: '10px', color: colors.textDimmer }}>ORGANIZED</div>
                              </div>
                            </div>

                            {!joined ? (
                              <button onClick={() => handleJoinBuilding(building)} style={{ ...styles.button('secondary'), width: '100%' }}>
                                Join Tenant Group →
                              </button>
                            ) : (
                              <button
                                onClick={() => setSelectedBuilding(building.id === selectedBuilding ? null : building.id)}
                                style={{ ...styles.button('primary'), width: '100%' }}
                              >
                                {selectedBuilding === building.id ? 'Hide Discussion' : 'View Discussion →'}
                              </button>
                            )}
                          </div>
                        );
                      })}
                    </div>

                    {/* Discussion */}
                    {selectedBuilding && joinedBuildings.includes(selectedBuilding) && (
                      <div style={{ ...styles.card, marginTop: '25px' }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '14px' }}>
                          Building Discussion — {buildings.find(b => b.id === selectedBuilding)?.address}
                        </h3>

                        {tenantMessages.filter(m => m.building === selectedBuilding).map(msg => (
                          <div key={msg.id} style={{
                            padding: '15px',
                            backgroundColor: msg.pinned ? '#1a1a0a' : colors.bg,
                            border: msg.pinned ? `1px solid ${colors.warning}` : 'none',
                            marginBottom: '10px'
                          }}>
                            {msg.pinned && <span style={{ ...styles.badge(colors.warning), marginBottom: '8px' }}>📌 Pinned</span>}
                            <div style={{ marginBottom: '8px' }}>{msg.text}</div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: colors.textDimmer }}>
                              <span>{msg.author} • {msg.time}</span>
                              <span>{msg.replies} replies</span>
                            </div>
                          </div>
                        ))}

                        <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                          <input
                            type="text"
                            value={newTenantMessage}
                            onChange={(e) => setNewTenantMessage(e.target.value)}
                            placeholder="Share with your building..."
                            style={{ ...styles.input, flex: 1 }}
                            onKeyPress={(e) => {
                              if (e.key === 'Enter' && newTenantMessage) {
                                fetch(`${API_BASE}/buildings/${selectedBuilding}/messages`, {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ text: newTenantMessage, author: 'You' }),
                                })
                                  .then(r => r.json())
                                  .then(msg => {
                                    setTenantMessages([msg, ...tenantMessages]);
                                    setNewTenantMessage('');
                                    showNotification('Message posted anonymously');
                                  })
                                  .catch(() => showNotification('Failed to post message', 'error'));
                              }
                            }}
                          />
                          <button
                            onClick={() => {
                              if (newTenantMessage) {
                                fetch(`${API_BASE}/buildings/${selectedBuilding}/messages`, {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ text: newTenantMessage, author: 'You' }),
                                })
                                  .then(r => r.json())
                                  .then(msg => {
                                    setTenantMessages([msg, ...tenantMessages]);
                                    setNewTenantMessage('');
                                    showNotification('Message posted anonymously');
                                  })
                                  .catch(() => showNotification('Failed to post message', 'error'));
                              }
                            }}
                            style={styles.button('primary')}
                          >
                            Post
                          </button>
                        </div>
                        <p style={{ fontSize: '10px', color: colors.textDimmest, marginTop: '10px', marginBottom: 0 }}>
                          Messages are anonymous. Tied to browser fingerprint, not identity.
                        </p>
                      </div>
                    )}
                  </section>
                )}

                {/* Worker Collectives */}
                {activeSubTab === 'worker' && (
                  <section>
                    <h2 style={styles.sectionHeader}>Worker Collectives</h2>
                    <p style={{ color: colors.textDim, marginBottom: '20px' }}>
                      Anonymous coordination for workplace issues. Find your coworkers.
                    </p>

                    <div style={styles.grid}>
                      {workerCollectives.map(collective => {
                        const joined = joinedCollectives.includes(collective.id);
                        return (
                          <div key={collective.id} style={{
                            ...styles.card,
                            border: joined ? `1px solid ${colors.success}` : `1px solid ${colors.border}`,
                            opacity: collective.active ? 1 : 0.7
                          }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px' }}>
                              <span style={styles.badge(colors.textMuted)}>{collective.industry}</span>
                              <span style={styles.badge(collective.active ? colors.success : colors.warning)}>
                                {collective.active ? 'Active' : 'Forming'}
                              </span>
                            </div>

                            <div style={{ fontWeight: 700, fontSize: '16px', marginBottom: '12px' }}>{collective.company}</div>

                            <div style={{ marginBottom: '15px' }}>
                              <div style={{ fontSize: '10px', color: colors.textDimmer, marginBottom: '6px' }}>ORGANIZING AROUND:</div>
                              <div style={{ display: 'flex', gap: '5px', flexWrap: 'wrap' }}>
                                {collective.issues.map(issue => (
                                  <span key={issue} style={{ ...styles.badge(colors.primary), marginRight: 0 }}>{issue}</span>
                                ))}
                              </div>
                            </div>

                            <div style={{ marginBottom: '15px' }}>
                              <span style={{ fontSize: '28px', fontWeight: 700 }}>{collective.members}</span>
                              <span style={{ fontSize: '12px', color: colors.textDim, marginLeft: '8px' }}>members</span>
                            </div>

                            {collective.telegram_url && (
                              <a
                                href={collective.telegram_url}
                                target="_blank"
                                rel="noopener noreferrer"
                                style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '8px',
                                  padding: '10px 12px',
                                  marginBottom: '15px',
                                  backgroundColor: '#0088cc15',
                                  border: '1px solid #0088cc40',
                                  color: '#0088cc',
                                  textDecoration: 'none',
                                  fontSize: '12px',
                                  fontWeight: 500,
                                }}
                              >
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                  <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.751-.244-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.015 3.333-1.386 4.025-1.627 4.477-1.635.099-.002.321.023.465.14.121.099.154.232.17.325.015.094.034.31.019.478z"/>
                                </svg>
                                Join Telegram Channel
                              </a>
                            )}

                            {!joined ? (
                              <button onClick={() => handleJoinCollective(collective)} style={{ ...styles.button('secondary'), width: '100%' }}>
                                Join Collective →
                              </button>
                            ) : (
                              <button
                                onClick={() => setSelectedCollective(collective.id === selectedCollective ? null : collective.id)}
                                style={{ ...styles.button('primary'), width: '100%' }}
                              >
                                {selectedCollective === collective.id ? 'Hide Discussion' : 'Open Discussion →'}
                              </button>
                            )}
                          </div>
                        );
                      })}
                    </div>

                    {/* Collective Discussion */}
                    {selectedCollective && joinedCollectives.includes(selectedCollective) && (
                      <div style={{ ...styles.card, marginTop: '25px' }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '14px' }}>
                          {workerCollectives.find(c => c.id === selectedCollective)?.company} — Worker Discussion
                        </h3>

                        {collectiveMessages.filter(m => m.collective === selectedCollective).map(msg => (
                          <div key={msg.id} style={{
                            padding: '15px',
                            backgroundColor: msg.pinned ? '#1a1a0a' : colors.bg,
                            border: msg.pinned ? `1px solid ${colors.warning}` : 'none',
                            marginBottom: '10px'
                          }}>
                            {msg.pinned && <span style={{ ...styles.badge(colors.warning), marginBottom: '8px' }}>📌 Pinned</span>}
                            <div style={{ marginBottom: '8px' }}>{msg.text}</div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: colors.textDimmer }}>
                              <span>{msg.author} • {msg.time}</span>
                              {msg.replies && <span>{msg.replies} replies</span>}
                            </div>
                          </div>
                        ))}

                        <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                          <input
                            type="text"
                            value={newCollectiveMessage}
                            onChange={(e) => setNewCollectiveMessage(e.target.value)}
                            placeholder="Share with your coworkers..."
                            style={{ ...styles.input, flex: 1 }}
                            onKeyPress={(e) => {
                              if (e.key === 'Enter' && newCollectiveMessage) {
                                fetch(`${API_BASE}/worker-collectives/${selectedCollective}/messages`, {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ text: newCollectiveMessage }),
                                })
                                  .then(r => r.json())
                                  .then(msg => {
                                    setCollectiveMessages([msg, ...collectiveMessages]);
                                    setNewCollectiveMessage('');
                                    showNotification('Message posted anonymously');
                                  })
                                  .catch(() => showNotification('Failed to post message', 'error'));
                              }
                            }}
                          />
                          <button
                            onClick={() => {
                              if (newCollectiveMessage) {
                                fetch(`${API_BASE}/worker-collectives/${selectedCollective}/messages`, {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ text: newCollectiveMessage }),
                                })
                                  .then(r => r.json())
                                  .then(msg => {
                                    setCollectiveMessages([msg, ...collectiveMessages]);
                                    setNewCollectiveMessage('');
                                    showNotification('Message posted anonymously');
                                  })
                                  .catch(() => showNotification('Failed to post message', 'error'));
                              }
                            }}
                            style={styles.button('primary')}
                          >
                            Post
                          </button>
                        </div>
                      </div>
                    )}

                    {/* New Collective */}
                    <div style={{ ...styles.card, marginTop: '30px', textAlign: 'center' }}>
                      <p style={{ color: colors.textMuted, marginBottom: '15px' }}>Don't see your workplace?</p>
                      <button onClick={() => setShowNewCollectiveForm(true)} style={styles.button('secondary')}>
                        + Start a New Collective
                      </button>
                    </div>

                    {/* New Collective Modal */}
                    {showNewCollectiveForm && (
                      <div style={styles.modal} className="modal-enter">
                        <div style={{ ...styles.card, maxWidth: '500px', width: '100%' }}>
                          <h3 style={{ marginTop: 0, marginBottom: '20px' }}>Start a Worker Collective</h3>

                          <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Company Name
                            </label>
                            <input
                              type="text"
                              value={newCollective.company}
                              onChange={(e) => setNewCollective({ ...newCollective, company: e.target.value })}
                              placeholder="Where do you work?"
                              style={styles.input}
                            />
                          </div>

                          <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Telegram Channel <span style={{ color: colors.textDimmer, fontWeight: 400 }}>(optional)</span>
                            </label>
                            <input
                              type="url"
                              value={newCollective.telegram_url}
                              onChange={(e) => setNewCollective({ ...newCollective, telegram_url: e.target.value })}
                              placeholder="https://t.me/your_channel"
                              style={styles.input}
                            />
                            <div style={{ fontSize: '10px', color: colors.textDimmer, marginTop: '4px' }}>
                              Link a Telegram channel for organizing outside this site
                            </div>
                          </div>

                          <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Industry
                            </label>
                            <select
                              value={newCollective.industry}
                              onChange={(e) => setNewCollective({ ...newCollective, industry: e.target.value })}
                              style={{ ...styles.input, cursor: 'pointer' }}
                            >
                              <option value="">Select industry...</option>
                              {['Retail', 'Food Service', 'Warehouse', 'Healthcare', 'Tech', 'Education', 'Transportation', 'Manufacturing', 'Other'].map(ind => (
                                <option key={ind} value={ind}>{ind}</option>
                              ))}
                            </select>
                          </div>

                          <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '10px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Issues to organize around
                            </label>
                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                              {['Wages', 'Scheduling', 'Safety', 'Benefits', 'Understaffing', 'Management', 'Other'].map(issue => (
                                <label key={issue} style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '8px',
                                  padding: '8px 12px',
                                  backgroundColor: newCollective.issues.includes(issue) ? '#ff333320' : colors.bgLighter,
                                  border: `1px solid ${newCollective.issues.includes(issue) ? colors.primary : colors.borderLight}`,
                                  cursor: 'pointer',
                                  fontSize: '12px'
                                }}>
                                  <input
                                    type="checkbox"
                                    checked={newCollective.issues.includes(issue)}
                                    onChange={() => toggleCollectiveIssue(issue)}
                                    style={{ accentColor: colors.primary }}
                                  />
                                  {issue}
                                </label>
                              ))}
                            </div>
                          </div>

                          <div style={{ display: 'flex', gap: '10px' }}>
                            <button onClick={() => setShowNewCollectiveForm(false)} style={{ ...styles.button('secondary'), flex: 1 }}>
                              Cancel
                            </button>
                            <button onClick={handleCreateCollective} style={{ ...styles.button('primary'), flex: 1 }}>
                              Create
                            </button>
                          </div>
                        </div>
                      </div>
                    )}
                  </section>
                )}

                {/* Consumer Groups */}
                {activeSubTab === 'consumer' && (
                  <section>
                    <h2 style={styles.sectionHeader}>Consumer Collectives</h2>
                    <p style={{ color: colors.textDim, marginBottom: '20px' }}>
                      Group buying power. Negotiate bulk rates for utilities and necessities.
                    </p>

                    <div style={styles.grid}>
                      {consumerGroups.map(group => {
                        const joined = joinedConsumerGroups.includes(group.id);
                        return (
                          <div key={group.id} style={{
                            ...styles.card,
                            border: joined ? `1px solid ${colors.success}` : `1px solid ${colors.border}`
                          }}>
                            <div style={{ fontWeight: 700, fontSize: '16px', marginBottom: '8px' }}>{group.name}</div>
                            <div style={{ fontSize: '12px', color: colors.textDim, marginBottom: '15px' }}>{group.description}</div>

                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                              <div>
                                <div style={{ fontSize: '28px', fontWeight: 700 }}>{group.members}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmer }}>MEMBERS</div>
                              </div>
                              <div style={{ textAlign: 'right' }}>
                                <div style={{ fontSize: '28px', fontWeight: 700, color: colors.success }}>{group.savings}</div>
                                <div style={{ fontSize: '10px', color: colors.textDimmer }}>AVG SAVINGS</div>
                              </div>
                            </div>

                            {!joined ? (
                              <button onClick={() => handleJoinConsumerGroup(group)} style={{ ...styles.button('secondary'), width: '100%' }}>
                                Join Group →
                              </button>
                            ) : (
                              <div style={{ textAlign: 'center', color: colors.success, fontSize: '12px', padding: '12px' }}>
                                ✓ You're a member
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </section>
                )}

                {/* Petitions */}
                {activeSubTab === 'petition' && (
                  <section>
                    <h2 style={styles.sectionHeader}>Local Petitions</h2>

                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '25px', flexWrap: 'wrap', gap: '15px' }}>
                      <p style={{ color: colors.textDim, margin: 0 }}>
                        Local petitions powered by Change.org. Signatures tracked live.
                      </p>
                      <button onClick={() => setShowPetitionForm(true)} style={styles.button('primary')}>
                        + Link Petition
                      </button>
                    </div>

                    {petitions.map(petition => {
                      const pct = petition.goal > 0 ? Math.min((petition.signatures / petition.goal) * 100, 100) : 0;
                      return (
                        <div key={petition.id} style={{
                          ...styles.card,
                          border: petition.status === 'won' ? `1px solid ${colors.success}` : `1px solid ${colors.border}`
                        }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '10px' }}>
                            <div style={{ flex: 1 }}>
                              <div style={{ fontWeight: 700, fontSize: '15px', marginBottom: '5px' }}>{petition.title}</div>
                              <div style={{ fontSize: '11px', color: colors.textDimmer }}>Area: {petition.area} • Created {petition.created}</div>
                              {petition.description && (
                                <div style={{ fontSize: '12px', color: colors.textDim, marginTop: '8px' }}>{petition.description}</div>
                              )}
                              {petition.changeorg_url && (
                                <a href={petition.changeorg_url} target="_blank" rel="noopener noreferrer"
                                  style={{ fontSize: '11px', color: colors.primary, textDecoration: 'none', display: 'inline-block', marginTop: '6px' }}>
                                  View on Change.org ↗
                                </a>
                              )}
                            </div>
                            {petition.status === 'won' && <span style={styles.badge(colors.success)}>✓ Won!</span>}
                            {petition.status === 'active' && <span style={styles.badge(colors.warning)}>Active</span>}
                          </div>

                          <div style={{ marginTop: '15px', marginBottom: '15px' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', marginBottom: '6px' }}>
                              <span style={{ fontWeight: 700 }}>{petition.signatures} signatures</span>
                              <span style={{ color: colors.textDimmer }}>Goal: {petition.goal}</span>
                            </div>
                            <div style={{ height: '10px', backgroundColor: colors.border, borderRadius: '5px' }}>
                              <div style={{
                                height: '100%',
                                width: `${pct}%`,
                                backgroundColor: petition.signatures >= petition.goal ? colors.success : colors.primary,
                                borderRadius: '5px',
                                transition: 'width 0.3s'
                              }} />
                            </div>
                          </div>

                          <div style={{ display: 'flex', gap: '10px' }}>
                            {petition.status === 'active' && petition.changeorg_url && (
                              <a href={petition.changeorg_url} target="_blank" rel="noopener noreferrer"
                                style={{ ...styles.button('secondary'), flex: 1, textAlign: 'center', textDecoration: 'none', display: 'block' }}>
                                Sign on Change.org →
                              </a>
                            )}
                            {petition.changeorg_url && (
                              <button onClick={() => handleRefreshPetition(petition)}
                                style={{ ...styles.button('secondary'), fontSize: '11px', padding: '10px 14px' }}
                                title="Refresh signature count from Change.org">
                                ↻ Refresh
                              </button>
                            )}
                          </div>
                        </div>
                      );
                    })}

                    {/* Petition Modal */}
                    {showPetitionForm && (
                      <div style={styles.modal} className="modal-enter">
                        <div style={{ ...styles.card, maxWidth: '500px', width: '100%' }}>
                          <h3 style={{ marginTop: 0, marginBottom: '20px' }}>Link Change.org Petition</h3>

                          <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Change.org URL *
                            </label>
                            <input
                              type="url"
                              value={newPetition.changeorg_url}
                              onChange={(e) => setNewPetition({ ...newPetition, changeorg_url: e.target.value })}
                              placeholder="https://www.change.org/p/your-petition"
                              style={styles.input}
                            />
                            <p style={{ fontSize: '10px', color: colors.textDimmest, margin: '5px 0 0 0' }}>
                              Paste the full URL of your Change.org petition. Signature counts will be pulled automatically.
                            </p>
                          </div>

                          <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Title *
                            </label>
                            <input
                              type="text"
                              value={newPetition.title}
                              onChange={(e) => setNewPetition({ ...newPetition, title: e.target.value })}
                              placeholder="What are you petitioning for?"
                              style={styles.input}
                            />
                          </div>

                          <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Area (ZIP or Neighborhood) *
                            </label>
                            <input
                              type="text"
                              value={newPetition.area}
                              onChange={(e) => setNewPetition({ ...newPetition, area: e.target.value })}
                              placeholder="Where does this apply?"
                              style={styles.input}
                            />
                          </div>

                          <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                              Description
                            </label>
                            <textarea
                              rows={4}
                              value={newPetition.description}
                              onChange={(e) => setNewPetition({ ...newPetition, description: e.target.value })}
                              placeholder="Explain the issue..."
                              style={{ ...styles.input, resize: 'vertical' }}
                            />
                          </div>

                          <div style={{ display: 'flex', gap: '10px' }}>
                            <button onClick={() => setShowPetitionForm(false)} style={{ ...styles.button('secondary'), flex: 1 }}>
                              Cancel
                            </button>
                            <button
                              onClick={handleCreatePetition}
                              disabled={!newPetition.changeorg_url || !newPetition.title || !newPetition.area}
                              style={{
                                ...styles.button('primary'), flex: 1,
                                opacity: (!newPetition.changeorg_url || !newPetition.title || !newPetition.area) ? 0.5 : 1,
                                cursor: (!newPetition.changeorg_url || !newPetition.title || !newPetition.area) ? 'not-allowed' : 'pointer'
                              }}>
                              Link Petition
                            </button>
                          </div>
                          <p style={{ fontSize: '10px', color: colors.textDimmest, marginTop: '15px', marginBottom: 0 }}>
                            Signatures and goals are pulled directly from Change.org. Click "Refresh" on any petition to update.
                          </p>
                        </div>
                      </div>
                    )}
                  </section>
                )}
              </div>
            )}

            {/* ==================== ACCOUNTABILITY TAB ==================== */}
            {activeTab === 'accountability' && (
              <div>
                <section style={{ marginBottom: '60px' }}>
                  <h2 style={styles.sectionHeader}>{textConfig.report_section_title}</h2>

                  <div style={{ display: 'flex', gap: '10px', marginBottom: '20px' }}>
                    {['landlord', 'employer'].map(type => (
                      <button
                        key={type}
                        onClick={() => setReportType(type)}
                        style={{
                          padding: '12px 25px',
                          backgroundColor: reportType === type ? colors.primary : 'transparent',
                          color: reportType === type ? '#000' : colors.textMuted,
                          border: `1px solid ${reportType === type ? colors.primary : colors.borderLight}`,
                          cursor: 'pointer',
                          fontFamily: 'inherit',
                          textTransform: 'uppercase',
                          fontSize: '12px',
                          letterSpacing: '1px',
                          fontWeight: reportType === type ? 700 : 400
                        }}
                      >
                        {type === 'landlord' ? textConfig.report_type_landlord : textConfig.report_type_employer}
                      </button>
                    ))}
                  </div>

                  <div style={styles.card}>
                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                        {reportType === 'landlord' ? textConfig.report_name_landlord : textConfig.report_name_employer}
                      </label>
                      <input
                        type="text"
                        value={newReport.name}
                        onChange={(e) => setNewReport({ ...newReport, name: e.target.value })}
                        placeholder={reportType === 'landlord' ? textConfig.report_name_landlord_placeholder : textConfig.report_name_employer_placeholder}
                        style={styles.input}
                      />
                    </div>

                    {reportType === 'landlord' && (
                      <div style={{ marginBottom: '20px' }}>
                        <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                          {textConfig.report_address_label}
                        </label>
                        <input
                          type="text"
                          value={newReport.address}
                          onChange={(e) => setNewReport({ ...newReport, address: e.target.value })}
                          placeholder={textConfig.report_address_placeholder}
                          style={styles.input}
                        />
                      </div>
                    )}

                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '10px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                        {textConfig.report_issues_label}
                      </label>
                      <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                        {(reportType === 'landlord'
                          ? [textConfig.issue_no_repairs, textConfig.issue_illegal_fees, textConfig.issue_harassment, textConfig.issue_safety_hazard, textConfig.issue_discrimination, textConfig.issue_retaliation, textConfig.issue_pest, textConfig.issue_no_heat, textConfig.issue_other]
                          : [textConfig.issue_wage_theft, textConfig.issue_unsafe, textConfig.issue_retaliation, textConfig.issue_discrimination, textConfig.issue_harassment, textConfig.issue_scheduling, textConfig.issue_unpaid_ot, textConfig.issue_other]
                        ).map(issue => (
                          <label key={issue} style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            padding: '10px 14px',
                            backgroundColor: newReport.issues.includes(issue) ? '#ff333320' : colors.bgLighter,
                            border: `1px solid ${newReport.issues.includes(issue) ? colors.primary : colors.borderLight}`,
                            cursor: 'pointer',
                            fontSize: '12px'
                          }}>
                            <input
                              type="checkbox"
                              checked={newReport.issues.includes(issue)}
                              onChange={() => toggleReportIssue(issue)}
                              style={{ accentColor: colors.primary }}
                            />
                            {issue}
                          </label>
                        ))}
                      </div>
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '5px', color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>
                        {textConfig.report_desc_label}
                      </label>
                      <textarea
                        rows={4}
                        value={newReport.description}
                        onChange={(e) => setNewReport({ ...newReport, description: e.target.value })}
                        placeholder={textConfig.report_desc_placeholder}
                        style={{ ...styles.input, resize: 'vertical' }}
                      />
                    </div>

                    <div style={{ marginBottom: '25px' }}>
                      <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                        <input
                          type="checkbox"
                          checked={newReport.anonymous}
                          onChange={(e) => setNewReport({ ...newReport, anonymous: e.target.checked })}
                          style={{ accentColor: colors.primary, width: '18px', height: '18px' }}
                        />
                        <span style={{ fontSize: '13px', color: colors.textMuted }}>{textConfig.report_anonymous}</span>
                      </label>
                    </div>

                    <button onClick={handleSubmitReport} style={{ ...styles.button('primary'), width: '100%', padding: '15px' }}>
                      {textConfig.report_submit_btn}
                    </button>

                    <p style={{ fontSize: '10px', color: colors.textDimmest, marginTop: '15px', textAlign: 'center' }}>
                      {textConfig.report_footer}
                    </p>
                  </div>
                </section>

                <section>
                  <h2 style={styles.sectionHeader}>{textConfig.reports_section_title}</h2>

                  <div style={{ display: 'flex', gap: '10px', marginBottom: '25px' }}>
                    {[
                      { key: 'all', label: textConfig.reports_filter_all },
                      { key: 'landlord', label: textConfig.reports_filter_landlord },
                      { key: 'employer', label: textConfig.reports_filter_employer }
                    ].map(filter => (
                      <button
                        key={filter.key}
                        onClick={() => setReportFilter(filter.key)}
                        style={{
                          padding: '8px 15px',
                          backgroundColor: reportFilter === filter.key ? colors.primary : 'transparent',
                          color: reportFilter === filter.key ? '#000' : colors.textDim,
                          border: `1px solid ${reportFilter === filter.key ? colors.primary : colors.borderLight}`,
                          cursor: 'pointer',
                          fontFamily: 'inherit',
                          fontSize: '11px',
                          textTransform: 'capitalize'
                        }}
                      >
                        {filter.label}
                      </button>
                    ))}
                  </div>

                  {reports.map(report => (
                    <div key={report.id} style={{
                      ...styles.card,
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      flexWrap: 'wrap',
                      gap: '15px'
                    }}>
                      <div style={{ flex: 1, minWidth: '200px' }}>
                        <div style={{ marginBottom: '8px' }}>
                          <span style={styles.badge(report.type === 'landlord' ? colors.warning : colors.purple)}>
                            {report.type === 'landlord' ? '🏠' : '💼'} {report.type}
                          </span>
                        </div>
                        <div style={{ fontWeight: 700, fontSize: '15px', marginBottom: '4px' }}>{report.name}</div>
                        {report.address && <div style={{ fontSize: '12px', color: colors.textDim, marginBottom: '8px' }}>{report.address}</div>}
                        <div style={{ display: 'flex', gap: '5px', flexWrap: 'wrap' }}>
                          {report.issues.map(issue => (
                            <span key={issue} style={{ ...styles.badge(colors.primary), marginRight: 0 }}>{issue}</span>
                          ))}
                        </div>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <div style={{ fontSize: '36px', fontWeight: 700, color: colors.primary }}>{report.reports}</div>
                        <div style={{ fontSize: '10px', color: colors.textDimmer }}>{textConfig.reports_count_label}</div>
                        <div style={{ fontSize: '11px', color: colors.textDimmest, marginTop: '5px' }}>{textConfig.reports_last} {report.lastReport}</div>
                      </div>
                    </div>
                  ))}
                </section>
              </div>
            )}
          </main>

          {/* Moderation Panel Toggle Button */}
          <button
            onClick={() => setShowModerationPanel(!showModerationPanel)}
            style={{
              position: 'fixed',
              bottom: '20px',
              right: '80px',
              width: '50px',
              height: '50px',
              borderRadius: '50%',
              backgroundColor: isModeratorAuthenticated ? '#4a9eff' : colors.bgLighter,
              color: isModeratorAuthenticated ? '#fff' : colors.textDim,
              border: `2px solid ${isModeratorAuthenticated ? '#4a9eff' : colors.border}`,
              cursor: 'pointer',
              fontSize: '18px',
              fontWeight: 700,
              zIndex: 999,
              boxShadow: '0 4px 12px rgba(0,0,0,0.5)',
              transition: 'all 0.2s',
            }}
            title="Moderation Panel"
          >
            🛡
          </button>

          {/* Customization Panel Toggle Button */}
          <button
            onClick={() => setShowCustomizationPanel(!showCustomizationPanel)}
            style={{
              position: 'fixed',
              bottom: '20px',
              right: '20px',
              width: '50px',
              height: '50px',
              borderRadius: '50%',
              backgroundColor: colors.primary,
              color: '#000',
              border: 'none',
              cursor: 'pointer',
              fontSize: '20px',
              fontWeight: 700,
              zIndex: 999,
              boxShadow: '0 4px 12px rgba(0,0,0,0.5)',
              transition: 'transform 0.2s',
            }}
            title="Customize Text & Styling"
          >
            ⚙
          </button>

          {/* Customization Panel */}
          {showCustomizationPanel && (
            <div style={{
              position: 'fixed',
              top: 0,
              right: 0,
              width: '450px',
              maxWidth: '100vw',
              height: '100vh',
              backgroundColor: colors.bgLight,
              borderLeft: `2px solid ${colors.primary}`,
              zIndex: 1000,
              display: 'flex',
              flexDirection: 'column',
              boxShadow: '-4px 0 20px rgba(0,0,0,0.5)',
            }} className="modal-enter">
              {/* Panel Header */}
              <div style={{
                padding: '20px',
                borderBottom: `1px solid ${colors.border}`,
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
              }}>
                <div>
                  <h2 style={{ margin: 0, fontSize: '16px', fontWeight: 700, color: colors.primary }}>
                    CUSTOMIZATION CONTROL PANEL
                  </h2>
                  <p style={{ margin: '4px 0 0', fontSize: '11px', color: colors.textDim }}>
                    Edit text, colors, and fonts
                  </p>
                </div>
                <button
                  onClick={() => setShowCustomizationPanel(false)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: colors.textMuted,
                    cursor: 'pointer',
                    fontSize: '24px',
                    padding: '5px',
                  }}
                >
                  ×
                </button>
              </div>

              {/* Panel Tabs */}
              <div style={{
                display: 'flex',
                borderBottom: `1px solid ${colors.border}`,
              }}>
                {['text', 'colors', 'fonts'].map(tab => (
                  <button
                    key={tab}
                    onClick={() => setPanelTab(tab)}
                    style={{
                      flex: 1,
                      padding: '12px',
                      backgroundColor: panelTab === tab ? colors.bgLighter : 'transparent',
                      color: panelTab === tab ? colors.primary : colors.textDim,
                      border: 'none',
                      borderBottom: panelTab === tab ? `2px solid ${colors.primary}` : '2px solid transparent',
                      cursor: 'pointer',
                      fontFamily: 'inherit',
                      fontSize: '11px',
                      textTransform: 'uppercase',
                      letterSpacing: '1px',
                      fontWeight: panelTab === tab ? 700 : 400,
                    }}
                  >
                    {tab}
                  </button>
                ))}
              </div>

              {/* Panel Content */}
              <div style={{
                flex: 1,
                overflow: 'auto',
                padding: '20px',
              }}>
                {/* Text Tab */}
                {panelTab === 'text' && (
                  <div>
                    {/* Search Filter */}
                    <input
                      type="text"
                      placeholder="Filter text elements..."
                      value={textFilter}
                      onChange={(e) => setTextFilter(e.target.value)}
                      style={{
                        ...styles.input,
                        marginBottom: '20px',
                        fontSize: '12px',
                      }}
                    />

                    {/* Text Categories */}
                    {Object.entries(textCategories).map(([category, keys]) => {
                      const filteredKeys = keys.filter(key =>
                        !textFilter ||
                        key.toLowerCase().includes(textFilter.toLowerCase()) ||
                        (textConfig[key] && textConfig[key].toLowerCase().includes(textFilter.toLowerCase()))
                      );
                      if (filteredKeys.length === 0) return null;

                      return (
                        <div key={category} style={{ marginBottom: '25px' }}>
                          <h3 style={{
                            fontSize: '11px',
                            color: colors.primary,
                            textTransform: 'uppercase',
                            letterSpacing: '2px',
                            marginBottom: '12px',
                            paddingBottom: '8px',
                            borderBottom: `1px solid ${colors.border}`,
                          }}>
                            {category}
                          </h3>
                          {filteredKeys.map(key => (
                            <div key={key} style={{ marginBottom: '12px' }}>
                              <label style={{
                                display: 'block',
                                fontSize: '10px',
                                color: colors.textDim,
                                marginBottom: '4px',
                                textTransform: 'uppercase',
                                letterSpacing: '0.5px',
                              }}>
                                {key.replace(/_/g, ' ')}
                              </label>
                              <input
                                type="text"
                                value={textConfig[key] || ''}
                                onChange={(e) => updateText(key, e.target.value)}
                                style={{
                                  ...styles.input,
                                  fontSize: '12px',
                                  padding: '8px 10px',
                                }}
                              />
                            </div>
                          ))}
                        </div>
                      );
                    })}
                  </div>
                )}

                {/* Colors Tab */}
                {panelTab === 'colors' && (
                  <div>
                    <p style={{ fontSize: '11px', color: colors.textDim, marginBottom: '20px' }}>
                      Customize the color scheme. Changes apply immediately.
                    </p>
                    {Object.entries(colorConfig).map(([key, value]) => (
                      <div key={key} style={{
                        display: 'flex',
                        alignItems: 'center',
                        marginBottom: '15px',
                        gap: '12px',
                      }}>
                        <input
                          type="color"
                          value={value}
                          onChange={(e) => updateColor(key, e.target.value)}
                          style={{
                            width: '40px',
                            height: '40px',
                            border: `1px solid ${colors.borderLight}`,
                            borderRadius: '4px',
                            cursor: 'pointer',
                            padding: '2px',
                            backgroundColor: colors.bgLighter,
                          }}
                        />
                        <div style={{ flex: 1 }}>
                          <div style={{
                            fontSize: '12px',
                            color: colors.text,
                            marginBottom: '2px',
                            textTransform: 'capitalize',
                          }}>
                            {key.replace(/([A-Z])/g, ' $1').trim()}
                          </div>
                          <div style={{ fontSize: '10px', color: colors.textDim }}>
                            {value}
                          </div>
                        </div>
                        <input
                          type="text"
                          value={value}
                          onChange={(e) => updateColor(key, e.target.value)}
                          style={{
                            ...styles.input,
                            width: '90px',
                            fontSize: '11px',
                            padding: '6px 8px',
                          }}
                        />
                      </div>
                    ))}
                  </div>
                )}

                {/* Fonts Tab */}
                {panelTab === 'fonts' && (
                  <div>
                    <p style={{ fontSize: '11px', color: colors.textDim, marginBottom: '20px' }}>
                      Choose fonts for different elements. Changes apply immediately.
                    </p>
                    {Object.entries(fontConfig).map(([key, value]) => (
                      <div key={key} style={{ marginBottom: '20px' }}>
                        <label style={{
                          display: 'block',
                          fontSize: '11px',
                          color: colors.textMuted,
                          marginBottom: '8px',
                          textTransform: 'uppercase',
                          letterSpacing: '1px',
                        }}>
                          {key} Font
                        </label>
                        <select
                          value={value}
                          onChange={(e) => updateFont(key, e.target.value)}
                          style={{
                            ...styles.input,
                            fontSize: '12px',
                            cursor: 'pointer',
                          }}
                        >
                          {fontOptions.map(font => (
                            <option key={font} value={font} style={{ fontFamily: font }}>
                              {font.split(',')[0].replace(/'/g, '')}
                            </option>
                          ))}
                        </select>
                        <div style={{
                          marginTop: '8px',
                          padding: '12px',
                          backgroundColor: colors.bgLighter,
                          border: `1px solid ${colors.border}`,
                          fontFamily: value,
                          fontSize: '14px',
                        }}>
                          Preview: The quick brown fox jumps over the lazy dog
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* Panel Footer */}
              <div style={{
                padding: '15px 20px',
                borderTop: `1px solid ${colors.border}`,
                display: 'flex',
                flexDirection: 'column',
                gap: '10px',
              }}>
                <div style={{ display: 'flex', gap: '10px' }}>
                  <button
                    onClick={exportConfig}
                    style={{
                      ...styles.button('secondary'),
                      flex: 1,
                      padding: '10px',
                      fontSize: '10px',
                    }}
                  >
                    Export
                  </button>
                  <label style={{
                    ...styles.button('secondary'),
                    flex: 1,
                    padding: '10px',
                    fontSize: '10px',
                    textAlign: 'center',
                    cursor: 'pointer',
                  }}>
                    Import
                    <input
                      type="file"
                      accept=".json"
                      onChange={importConfig}
                      style={{ display: 'none' }}
                    />
                  </label>
                </div>
                <button
                  onClick={resetAllConfig}
                  style={{
                    ...styles.button('primary'),
                    padding: '10px',
                    fontSize: '10px',
                    backgroundColor: colors.warning,
                    color: '#000',
                  }}
                >
                  Reset All to Defaults
                </button>
              </div>
            </div>
          )}

          {/* Moderation Panel */}
          {showModerationPanel && (
            <div style={{
              position: 'fixed',
              top: 0,
              right: 0,
              width: '550px',
              maxWidth: '100vw',
              height: '100vh',
              backgroundColor: colors.bgLight,
              borderLeft: `2px solid #4a9eff`,
              zIndex: 1001,
              display: 'flex',
              flexDirection: 'column',
              boxShadow: '-4px 0 20px rgba(0,0,0,0.5)',
            }} className="modal-enter">
              {/* Panel Header */}
              <div style={{
                padding: '20px',
                borderBottom: `1px solid ${colors.border}`,
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
              }}>
                <div>
                  <h2 style={{ margin: 0, fontSize: '16px', fontWeight: 700, color: '#4a9eff' }}>
                    MODERATION PANEL
                  </h2>
                  <p style={{ margin: '4px 0 0', fontSize: '11px', color: colors.textDim }}>
                    {isModeratorAuthenticated ? 'Manage user-generated content' : 'Enter admin key to access'}
                  </p>
                </div>
                <button
                  onClick={() => setShowModerationPanel(false)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: colors.textMuted,
                    cursor: 'pointer',
                    fontSize: '24px',
                    padding: '5px',
                  }}
                >
                  ×
                </button>
              </div>

              {/* Authentication or Content */}
              {!isModeratorAuthenticated ? (
                <div style={{ padding: '30px' }}>
                  <div style={{ marginBottom: '20px' }}>
                    <label style={{ display: 'block', marginBottom: '8px', fontSize: '12px', color: colors.textMuted }}>
                      Admin Key
                    </label>
                    <input
                      type="password"
                      value={moderationKey}
                      onChange={(e) => setModerationKey(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && verifyModerationKey()}
                      placeholder="Enter admin key..."
                      style={{ ...styles.input, marginBottom: '15px' }}
                    />
                    <button
                      onClick={verifyModerationKey}
                      style={{ ...styles.button('primary'), width: '100%', backgroundColor: '#4a9eff' }}
                    >
                      Authenticate
                    </button>
                  </div>
                  <p style={{ fontSize: '11px', color: colors.textDimmer, textAlign: 'center' }}>
                    Default key: solidarity-admin-2024
                  </p>
                </div>
              ) : (
                <>
                  {/* Moderation Tabs */}
                  <div style={{
                    display: 'flex',
                    borderBottom: `1px solid ${colors.border}`,
                    overflowX: 'auto',
                  }}>
                    {['messages', 'petitions', 'reports', 'collectives', 'banned', 'log'].map(tab => (
                      <button
                        key={tab}
                        onClick={() => setModerationTab(tab)}
                        style={{
                          padding: '12px 16px',
                          backgroundColor: moderationTab === tab ? colors.bgLighter : 'transparent',
                          color: moderationTab === tab ? '#4a9eff' : colors.textDim,
                          border: 'none',
                          borderBottom: moderationTab === tab ? '2px solid #4a9eff' : '2px solid transparent',
                          cursor: 'pointer',
                          fontFamily: 'inherit',
                          fontSize: '10px',
                          textTransform: 'uppercase',
                          letterSpacing: '0.5px',
                          fontWeight: moderationTab === tab ? 700 : 400,
                          whiteSpace: 'nowrap',
                        }}
                      >
                        {tab}
                      </button>
                    ))}
                  </div>

                  {/* Content Area */}
                  <div style={{ flex: 1, overflow: 'auto', padding: '20px' }}>
                    {moderationLoading ? (
                      <div style={{ textAlign: 'center', padding: '40px', color: colors.textDim }}>Loading...</div>
                    ) : !moderationContent ? (
                      <div style={{ textAlign: 'center', padding: '40px', color: colors.textDim }}>
                        <button onClick={loadModerationContent} style={styles.button('primary')}>
                          Load Content
                        </button>
                      </div>
                    ) : (
                      <>
                        {/* Messages Tab */}
                        {moderationTab === 'messages' && (
                          <div>
                            <h4 style={{ margin: '0 0 15px', fontSize: '12px', color: colors.textMuted }}>
                              Tenant Messages ({moderationContent.tenantMessages?.length || 0})
                            </h4>
                            {moderationContent.tenantMessages?.map(msg => (
                              <div key={`tm-${msg.id}`} style={{
                                padding: '12px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '10px',
                                fontSize: '12px',
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                  <span style={{ color: colors.textDim }}>{msg.building_address || msg.building_id}</span>
                                  <span style={{ color: colors.textDimmer }}>{msg.time}</span>
                                </div>
                                <div style={{ marginBottom: '8px' }}>{msg.text}</div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                  <span style={{ color: colors.textDimmer }}>by {msg.author}</span>
                                  <div style={{ display: 'flex', gap: '8px' }}>
                                    <button
                                      onClick={() => moderationTogglePin('tenant', msg.id)}
                                      style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px' }}
                                    >
                                      {msg.pinned ? 'Unpin' : 'Pin'}
                                    </button>
                                    <button
                                      onClick={() => moderationDelete('tenant-messages', msg.id)}
                                      style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px', color: colors.primary }}
                                    >
                                      Delete
                                    </button>
                                  </div>
                                </div>
                              </div>
                            ))}

                            <h4 style={{ margin: '25px 0 15px', fontSize: '12px', color: colors.textMuted }}>
                              Collective Messages ({moderationContent.collectiveMessages?.length || 0})
                            </h4>
                            {moderationContent.collectiveMessages?.map(msg => (
                              <div key={`cm-${msg.id}`} style={{
                                padding: '12px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '10px',
                                fontSize: '12px',
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                  <span style={{ color: colors.textDim }}>{msg.collective_name || msg.collective_id}</span>
                                  <span style={{ color: colors.textDimmer }}>{msg.time}</span>
                                </div>
                                <div style={{ marginBottom: '8px' }}>{msg.text}</div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                  <span style={{ color: colors.textDimmer }}>by {msg.author}</span>
                                  <div style={{ display: 'flex', gap: '8px' }}>
                                    <button
                                      onClick={() => moderationTogglePin('collective', msg.id)}
                                      style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px' }}
                                    >
                                      {msg.pinned ? 'Unpin' : 'Pin'}
                                    </button>
                                    <button
                                      onClick={() => moderationDelete('collective-messages', msg.id)}
                                      style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px', color: colors.primary }}
                                    >
                                      Delete
                                    </button>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Petitions Tab */}
                        {moderationTab === 'petitions' && (
                          <div>
                            {moderationContent.petitions?.map(petition => (
                              <div key={petition.id} style={{
                                padding: '12px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '10px',
                                fontSize: '12px',
                              }}>
                                <div style={{ fontWeight: 700, marginBottom: '6px' }}>{petition.title}</div>
                                <div style={{ color: colors.textDim, marginBottom: '6px' }}>{petition.description}</div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                  <span style={{ color: colors.textDimmer }}>
                                    {petition.area} • {petition.signatures}/{petition.goal} • {petition.created}
                                  </span>
                                  <button
                                    onClick={() => moderationDelete('petitions', petition.id)}
                                    style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px', color: colors.primary }}
                                  >
                                    Delete
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Reports Tab */}
                        {moderationTab === 'reports' && (
                          <div>
                            {moderationContent.reports?.map(report => (
                              <div key={report.id} style={{
                                padding: '12px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '10px',
                                fontSize: '12px',
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>
                                  <span style={{ fontWeight: 700 }}>{report.name}</span>
                                  <span style={styles.badge(report.type === 'landlord' ? colors.warning : colors.primary)}>
                                    {report.type}
                                  </span>
                                </div>
                                <div style={{ color: colors.textDim, marginBottom: '6px' }}>
                                  {report.address && <span>{report.address} • </span>}
                                  Issues: {report.issues?.join(', ')}
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                  <span style={{ color: colors.textDimmer }}>
                                    {report.report_count} reports • {report.lastReport}
                                  </span>
                                  <button
                                    onClick={() => moderationDelete('reports', report.id)}
                                    style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px', color: colors.primary }}
                                  >
                                    Delete
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Collectives Tab */}
                        {moderationTab === 'collectives' && (
                          <div>
                            {moderationContent.collectives?.map(collective => (
                              <div key={collective.id} style={{
                                padding: '12px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '10px',
                                fontSize: '12px',
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>
                                  <span style={{ fontWeight: 700 }}>{collective.company}</span>
                                  <span style={styles.badge(colors.textMuted)}>{collective.industry}</span>
                                </div>
                                <div style={{ color: colors.textDim, marginBottom: '6px' }}>
                                  {collective.members} members • Issues: {collective.issues?.join(', ')}
                                </div>
                                {collective.telegram_url && (
                                  <div style={{ color: '#0088cc', marginBottom: '6px', fontSize: '11px' }}>
                                    {collective.telegram_url}
                                  </div>
                                )}
                                <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
                                  <button
                                    onClick={() => moderationDelete('collectives', collective.id)}
                                    style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px', color: colors.primary }}
                                  >
                                    Delete
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Banned Tab */}
                        {moderationTab === 'banned' && (
                          <div>
                            <div style={{ marginBottom: '20px', padding: '15px', backgroundColor: colors.bg, border: `1px solid ${colors.border}` }}>
                              <h4 style={{ margin: '0 0 12px', fontSize: '12px', color: colors.textMuted }}>Ban Author</h4>
                              <input
                                type="text"
                                value={banAuthor.name}
                                onChange={(e) => setBanAuthor({ ...banAuthor, name: e.target.value })}
                                placeholder="Author name..."
                                style={{ ...styles.input, marginBottom: '10px', fontSize: '12px' }}
                              />
                              <input
                                type="text"
                                value={banAuthor.reason}
                                onChange={(e) => setBanAuthor({ ...banAuthor, reason: e.target.value })}
                                placeholder="Reason (optional)..."
                                style={{ ...styles.input, marginBottom: '10px', fontSize: '12px' }}
                              />
                              <button
                                onClick={moderationBan}
                                style={{ ...styles.button('primary'), fontSize: '11px', backgroundColor: colors.primary }}
                              >
                                Ban Author
                              </button>
                            </div>

                            <h4 style={{ margin: '0 0 12px', fontSize: '12px', color: colors.textMuted }}>
                              Banned Authors ({moderationContent.bannedAuthors?.length || 0})
                            </h4>
                            {moderationContent.bannedAuthors?.map(banned => (
                              <div key={banned.id} style={{
                                padding: '12px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '10px',
                                fontSize: '12px',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                              }}>
                                <div>
                                  <span style={{ fontWeight: 700 }}>{banned.author_name}</span>
                                  {banned.reason && <span style={{ color: colors.textDim }}> — {banned.reason}</span>}
                                </div>
                                <button
                                  onClick={() => moderationUnban(banned.id)}
                                  style={{ ...styles.button('secondary'), padding: '4px 8px', fontSize: '10px' }}
                                >
                                  Unban
                                </button>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Log Tab */}
                        {moderationTab === 'log' && (
                          <div>
                            <h4 style={{ margin: '0 0 12px', fontSize: '12px', color: colors.textMuted }}>
                              Recent Actions
                            </h4>
                            {moderationContent.moderationLog?.map(entry => (
                              <div key={entry.id} style={{
                                padding: '10px',
                                backgroundColor: colors.bg,
                                border: `1px solid ${colors.border}`,
                                marginBottom: '8px',
                                fontSize: '11px',
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                                  <span style={{
                                    ...styles.badge(
                                      entry.action === 'delete' ? colors.primary :
                                      entry.action === 'ban' ? colors.warning :
                                      entry.action === 'unban' ? colors.success :
                                      colors.textMuted
                                    ),
                                    fontSize: '9px',
                                  }}>
                                    {entry.action.toUpperCase()}
                                  </span>
                                  <span style={{ color: colors.textDimmer }}>{entry.time}</span>
                                </div>
                                <div style={{ color: colors.textDim }}>
                                  {entry.content_type}: {entry.content_preview}
                                </div>
                                {entry.reason && (
                                  <div style={{ color: colors.textDimmer, fontStyle: 'italic', marginTop: '4px' }}>
                                    Reason: {entry.reason}
                                  </div>
                                )}
                              </div>
                            ))}
                          </div>
                        )}
                      </>
                    )}
                  </div>

                  {/* Refresh Button */}
                  {isModeratorAuthenticated && (
                    <div style={{ padding: '15px', borderTop: `1px solid ${colors.border}` }}>
                      <button
                        onClick={loadModerationContent}
                        disabled={moderationLoading}
                        style={{ ...styles.button('secondary'), width: '100%', fontSize: '11px' }}
                      >
                        {moderationLoading ? 'Loading...' : 'Refresh Content'}
                      </button>
                    </div>
                  )}
                </>
              )}
            </div>
          )}

          {/* Footer */}
          <footer style={{
            borderTop: `1px solid ${colors.border}`,
            padding: '30px 40px',
            marginTop: '60px',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            flexWrap: 'wrap',
            gap: '20px'
          }}>
            <div style={{ fontSize: '11px', color: colors.textDimmest }}>
              <div style={{ fontWeight: 700, marginBottom: '4px' }}>{textConfig.footer_brand}</div>
              <div>{textConfig.footer_tagline}</div>
            </div>
            <div style={{ display: 'flex', gap: '25px', fontSize: '11px' }}>
              <a href="#" style={{ color: colors.textDim, textDecoration: 'none' }}>{textConfig.footer_source}</a>
              <a href="#" style={{ color: colors.textDim, textDecoration: 'none' }}>{textConfig.footer_data}</a>
              <a href="#" style={{ color: colors.textDim, textDecoration: 'none' }}>{textConfig.footer_privacy}</a>
            </div>
          </footer>
        </div>
      );
    };

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SolidarityPlatform />);
  </script>
</body>
</html>
